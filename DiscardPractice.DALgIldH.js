import{z as e,c as l,r as a,w as s,o as t,a as n,q as u,e as r,i,s as c,b as v,v as o,u as d,f,t as p,h,n as g,F as m,l as y,p as k,T as w,y as b}from"./vendor.BQAVRTmg.js";import{_ as D,a as T,g as x}from"./index.D0mN0E-X.js";const M={key:0,class:"discard-practice-overlay"},C={class:"discard-practice-container"},P={class:"practice-header"},G={class:"practice-stats"},N={class:"stat-item"},S={key:0,class:"stat-item hourly-progress"},_={class:"hour-label"},z={class:"hour-bar"},E={class:"hour-text"},H={class:"practice-content"},A={key:0,class:"loading-state"},R={key:1,class:"hand-display"},I={class:"hand-label"},j={key:0},q={key:1,class:"result-correct"},F={key:2,class:"result-wrong"},L=["onClick","onDblclick","onDragstart","onDragover","onDrop","onTouchstart"],Q=["src","alt"],O={key:0,class:"new-badge"},V={key:1,class:"gap-line"},W={key:0,class:"groups-preview"},X={class:"groups-row"},Y={key:0,class:"group-sep"},$={key:2,class:"result-section"},B={class:"result-comparison"},J={class:"result-item your-choice"},K={class:"result-tile"},U=["src","alt"],Z={class:"result-info"},ee={key:0,class:"shanten"},le={class:"ting-count"},ae={class:"rank"},se={class:"result-tile"},te=["src","alt"],ne={class:"result-info"},ue={key:0,class:"shanten"},re={class:"ting-count"},ie={key:0,class:"ting-diff-view"},ce={key:0,class:"diff-section common"},ve={class:"diff-label"},oe={class:"diff-tiles"},de=["src"],fe={key:1,class:"diff-section missing"},pe={class:"diff-label"},he={class:"diff-tiles"},ge=["src"],me={key:2,class:"diff-section extra"},ye={class:"diff-label"},ke={class:"diff-tiles"},we=["src"],be={key:1,class:"ting-correct"},De={class:"ting-tiles"},Te=["src"],xe={class:"action-btns"},Me=["disabled"],Ce=D({__name:"DiscardPractice",setup(D){const Ce=T(),{discardPracticeMode:Pe,discardPracticeHand:Ge,discardPracticeRecommendations:Ne}=e(Ce),Se=l(()=>(new Date).getHours()),_e=l(()=>Ce.hourlyProgress),ze=l(()=>_e.value?Math.min(100,Math.round(_e.value.current/_e.value.total*100)):0),Ee=Pe,He=a([]);let Ae=0;const Re=a(-1),Ie=a(-1),je=a(null),qe=a(-1),Fe=a(-1),Le=a(!1),Qe=()=>{const e=Ge.value||[];if(0===e.length)return void(He.value=[]);const l=e.slice(0,-1),a=e.length>0?e[e.length-1]:null,s=(t=l,[...t].sort((e,l)=>e-l));var t;He.value=s.map(e=>({id:++Ae,code:e,hasGap:!1,isNew:!1})),null!==a&&He.value.push({id:++Ae,code:a,hasGap:!1,isNew:!0})},Oe=l(()=>He.value.map(e=>e.code)),Ve=()=>{Re.value=-1,Ie.value=-1},We=e=>{if(!Le.value)return;const l=e.touches[0],a=document.elementFromPoint(l.clientX,l.clientY);if(a&&je.value){const e=a.closest(".tile-wrapper");if(e){const l=Array.from(je.value.querySelectorAll(".tile-wrapper")).indexOf(e);-1!==l&&(Fe.value=l,Ie.value=l)}}},Xe=()=>{if(Le.value&&-1!==qe.value&&-1!==Fe.value&&qe.value!==Fe.value){const e=He.value.splice(qe.value,1)[0];He.value.splice(Fe.value,0,e)}qe.value=-1,Fe.value=-1,Le.value=!1,Re.value=-1,Ie.value=-1},Ye=l(()=>He.value.some(e=>e.hasGap)),$e=l(()=>{const e=[];let l=[];return He.value.forEach((a,s)=>{l.push(a.code),(a.hasGap||s===He.value.length-1)&&(l.length>0&&e.push([...l]),l=[])}),e}),Be=e=>35===Number(e),Je=e=>{const l=Number(e);return l>=1&&l<=9||l>=11&&l<=19||l>=21&&l<=29},Ke=e=>{if(e.length<2)return!1;const l=e.map(Number).filter(e=>!Be(e));if(0===l.length)return!0;const a=l[0];return l.every(e=>e===a)},Ue=e=>{if(3!==e.length)return!1;const l=e.map(Number),a=l.filter(Be).length,s=l.filter(e=>!Be(e));if(!s.every(Je))return!1;if(3===a)return!0;if(2===a&&1===s.length)return!0;if(1===a&&2===s.length){const e=s.sort((e,l)=>e-l);if(Math.floor(e[0]/10)!==Math.floor(e[1]/10))return!1;const l=e[1]-e[0];return 1===l||2===l}if(0===a){const e=s.sort((e,l)=>e-l);return Math.floor(e[0]/10)===Math.floor(e[1]/10)&&Math.floor(e[1]/10)===Math.floor(e[2]/10)&&e[1]-e[0]===1&&e[2]-e[1]===1}return!1},Ze=e=>{if(2!==e.length)return!1;const l=e.map(Number),a=l.filter(Be).length,s=l.filter(e=>!Be(e));if(2===a)return!1;if(1===a&&1===s.length)return Je(s[0]);const t=s.sort((e,l)=>e-l),n=t[0],u=t[1];if(!Je(n)||!Je(u))return!1;if(Math.floor(n/10)!==Math.floor(u/10))return!1;const r=u-n;return 1===r||2===r},el=e=>{const l=e.length;return 4===l&&Ke(e)?"group-gangzi":3===l&&Ke(e)?"group-kezi":3===l&&Ue(e)?"group-shunzi":2===l&&Ke(e)?"group-duizi":2===l&&Ze(e)?"group-dazi":"group-other"},ll=e=>{const l=e.length;return 4===l&&Ke(e)?"æ å­":3===l&&Ke(e)?"åˆ»å­":3===l&&Ue(e)?"é¡ºå­":2===l&&Ke(e)?"å¯¹å­":2===l&&Ze(e)?"æ­å­":1===l?"å•å¼ ":`${l}å¼ `},al=l(()=>Ne.value||[]),sl=a(-1),tl=a(!1),nl=a(0),ul=a(0),rl=a(Date.now()),il=a(0),cl=l(()=>sl.value>=0&&He.value[sl.value]?He.value[sl.value].code:null),vl=l(()=>al.value.length>0?al.value[0].discardTile:null);l(()=>vl.value?He.value.findIndex(e=>e.code===vl.value):-1);const ol=l(()=>cl.value===vl.value),dl=l(()=>{if(!cl.value)return 0;const e=al.value.findIndex(e=>e.discardTile===cl.value);return e>=0?e+1:al.value.length+1}),fl=l(()=>{if(!cl.value)return 0;const e=al.value.find(e=>e.discardTile===cl.value);return e?e.waitingCount:0}),pl=l(()=>{if(!cl.value)return[];const e=al.value.find(e=>e.discardTile===cl.value);return e?e.waitingTiles:[]}),hl=l(()=>al.value.length>0?al.value[0].waitingCount:0),gl=l(()=>{if(!cl.value)return;const e=al.value.find(e=>e.discardTile===cl.value);return e?e.round:void 0}),ml=l(()=>{if(al.value.length>0)return al.value[0].round}),yl=l(()=>al.value.length>0&&al.value[0].waitingTiles||[]),kl=l(()=>{const e=new Set(pl.value);return yl.value.filter(l=>e.has(l))}),wl=l(()=>{const e=new Set(pl.value);return yl.value.filter(l=>!e.has(l))}),bl=l(()=>{const e=new Set(yl.value);return pl.value.filter(l=>!e.has(l))});let Dl=null;const Tl=()=>{tl.value=!0,nl.value++;const e=(Date.now()-rl.value)/1e3;il.value=e;const l=ol.value;l&&(ul.value++,Ce.addExp(8)),Ce.recordDiscardPracticeResult(l,e)},xl=a(!1),Ml=()=>{tl.value=!1,sl.value=-1,rl.value=Date.now(),Qe()},Cl=()=>{return e=null,l=null,a=function*(){tl.value=!1,sl.value=-1,rl.value=Date.now(),xl.value=!0;try{yield Ce.generateDiscardQuestion()}catch(e){}finally{xl.value=!1}},new Promise((s,t)=>{var n=e=>{try{r(a.next(e))}catch(l){t(l)}},u=e=>{try{r(a.throw(e))}catch(l){t(l)}},r=e=>e.done?s(e.value):Promise.resolve(e.value).then(n,u);r((a=a.apply(e,l)).next())});var e,l,a},Pl=()=>{Ce.exitDiscardPractice()},Gl=()=>{Ce.returnToHomeWithCurrentHand()};s(Ee,e=>{e&&(nl.value=0,ul.value=0,tl.value=!1,sl.value=-1,rl.value=Date.now(),Qe())}),s(Ge,e=>{Ee.value&&e&&e.length>0&&Qe()},{immediate:!0});const Nl=e=>{if(Ee.value)return"Escape"===e.code?(e.preventDefault(),void Pl()):void("Space"===e.code&&tl.value&&!xl.value&&(e.preventDefault(),Cl()))};return t(()=>{window.addEventListener("keydown",Nl),Ce.checkAndGenerateHourlyQuestions(),Ee.value&&Ge.value.length>0&&Qe()}),n(()=>{window.removeEventListener("keydown",Nl)}),(e,l)=>(r(),u(b,{to:"body"},[i(w,{name:"fade-scale"},{default:c(()=>[d(Ee)?(r(),v("div",M,[f("div",C,[f("div",P,[l[1]||(l[1]=f("h4",null,"ğŸ¯ èˆç‰Œç»ƒä¹ ",-1)),f("div",G,[f("span",N,p(ul.value)+"/"+p(nl.value)+" æ­£ç¡®",1),_e.value?(r(),v("span",S,[f("span",_,p(Se.value)+"ç‚¹",1),f("span",z,[f("span",{class:g(["hour-fill",{completed:_e.value.completed}]),style:h({width:ze.value+"%"})},null,6)]),f("span",E,p(_e.value.current)+"/"+p(_e.value.total),1)])):o("",!0),l[0]||(l[0]=f("span",{class:"stat-item hint"},"æŒ‰ç©ºæ ¼ä¸‹ä¸€é¢˜",-1)),f("button",{onClick:Gl,class:"home-btn",title:"å¸¦ç‰Œå›é¦–é¡µåˆ†æ"},"â†©ï¸"),f("button",{onClick:Pl,class:"exit-btn"},"âœ• é€€å‡º (ESC)")])]),f("div",H,[0===Oe.value.length||xl.value?(r(),v("div",A,l[2]||(l[2]=[f("span",null,"â³ æ­£åœ¨ç”Ÿæˆé¢˜ç›®...",-1)]))):He.value.length>0&&!xl.value?(r(),v("div",R,[f("div",I,[tl.value?ol.value?(r(),v("span",q,"âœ… æ­£ç¡®ï¼è¿™æ˜¯æœ€ä¼˜é€‰æ‹©")):(r(),v("span",F,"âŒ å¯ä»¥æ›´å¥½")):(r(),v("span",j,"ç‚¹å‡»å‡ºç‰Œ | åŒå‡»åˆ†ç»„ | å¯æ‹–æ‹½æ’åº"))]),f("div",{class:"tiles-row",ref_key:"tilesRowRef",ref:je},[(r(!0),v(m,null,y(He.value,(e,l)=>{return r(),v("div",{key:e.id,class:g(["tile-wrapper",{"new-tile":e.isNew,selected:sl.value===l,best:tl.value&&(a=e.code,a===vl.value),disabled:tl.value,dragging:Re.value===l,"drop-target":Ie.value===l,"has-gap":e.hasGap}]),draggable:"true",onClick:e=>(e=>{tl.value||(Dl&&(clearTimeout(Dl),Dl=null),Dl=setTimeout(()=>{sl.value=e,Tl(),Dl=null},500))})(l),onDblclick:k(e=>(e=>{Dl&&(clearTimeout(Dl),Dl=null),e<He.value.length-1&&(He.value[e].hasGap=!He.value[e].hasGap)})(l),["stop"]),onDragstart:e=>((e,l)=>{Re.value=l,e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",l.toString())})(e,l),onDragend:Ve,onDragover:k(e=>((e,l)=>{e.preventDefault(),Ie.value=l})(e,l),["prevent"]),onDrop:e=>((e,l)=>{e.preventDefault();const a=Re.value;if(-1!==a&&a!==l){const e=He.value.splice(a,1)[0];He.value.splice(l,0,e)}Re.value=-1,Ie.value=-1})(e,l),onTouchstart:e=>((e,l)=>{qe.value=l,Le.value=!0,Re.value=l})(0,l),onTouchmove:We,onTouchend:Xe},[f("img",{src:d(x)(e.code),alt:e.code,class:"tile-img"},null,8,Q),e.isNew?(r(),v("div",O,"æ‘¸")):o("",!0),e.hasGap?(r(),v("div",V)):o("",!0)],42,L);var a}),128))],512),Ye.value?(r(),v("div",W,[f("div",X,[(r(!0),v(m,null,y($e.value,(e,l)=>(r(),v(m,{key:l},[f("div",{class:g(["group-tag",el(e)])},p(ll(e)),3),l<$e.value.length-1?(r(),v("span",Y,"Â·")):o("",!0)],64))),128))])])):o("",!0)])):o("",!0),tl.value?(r(),v("div",$,[f("div",B,[f("div",J,[l[3]||(l[3]=f("div",{class:"result-label"},"ä½ çš„é€‰æ‹©",-1)),f("div",K,[f("img",{src:d(x)(cl.value),alt:cl.value},null,8,U)]),f("div",Z,[void 0!==gl.value?(r(),v("span",ee,p(gl.value)+"å‘å¬",1)):o("",!0),f("span",le,p(pl.value.length)+"é—¨"+p(fl.value)+"å¼ ",1),f("span",ae,"ç¬¬"+p(dl.value)+"å",1)])]),l[6]||(l[6]=f("div",{class:"vs"},"VS",-1)),f("div",{class:g(["result-item best-choice",{same:ol.value}])},[l[5]||(l[5]=f("div",{class:"result-label"},"æœ€ä¼˜é€‰æ‹©",-1)),f("div",se,[f("img",{src:d(x)(vl.value),alt:vl.value},null,8,te)]),f("div",ne,[void 0!==ml.value?(r(),v("span",ue,p(ml.value)+"å‘å¬",1)):o("",!0),f("span",re,p(yl.value.length)+"é—¨"+p(hl.value)+"å¼ ",1),l[4]||(l[4]=f("span",{class:"rank"},"ç¬¬1å",-1))])],2)]),ol.value?o("",!0):(r(),v("div",ie,[kl.value.length>0?(r(),v("div",ce,[f("div",ve,[l[7]||(l[7]=f("span",{class:"diff-icon"},"âœ“",-1)),f("span",null,"å…±åŒ ("+p(kl.value.length)+"å¼ )",1)]),f("div",oe,[(r(!0),v(m,null,y(kl.value,e=>(r(),v("img",{key:e,src:d(x)(e),class:"diff-tile common"},null,8,de))),128))])])):o("",!0),wl.value.length>0?(r(),v("div",fe,[f("div",pe,[l[8]||(l[8]=f("span",{class:"diff-icon"},"âˆ’",-1)),f("span",null,"ä½ å°‘å¬ ("+p(wl.value.length)+"å¼ )",1)]),f("div",he,[(r(!0),v(m,null,y(wl.value,e=>(r(),v("img",{key:e,src:d(x)(e),class:"diff-tile missing"},null,8,ge))),128))])])):o("",!0),bl.value.length>0?(r(),v("div",me,[f("div",ye,[l[9]||(l[9]=f("span",{class:"diff-icon"},"+",-1)),f("span",null,"ä½ å¤šå¬ ("+p(bl.value.length)+"å¼ )",1)]),f("div",ke,[(r(!0),v(m,null,y(bl.value,e=>(r(),v("img",{key:e,src:d(x)(e),class:"diff-tile extra"},null,8,we))),128))])])):o("",!0)])),ol.value&&pl.value.length>0?(r(),v("div",be,[l[10]||(l[10]=f("div",{class:"ting-label"},"ğŸ¯ å¬ç‰Œ:",-1)),f("div",De,[(r(!0),v(m,null,y(pl.value,e=>(r(),v("img",{key:e,src:d(x)(e),class:"ting-tile"},null,8,Te))),128))])])):o("",!0),f("div",xe,[f("button",{onClick:Ml,class:"retry-btn"}," ğŸ”„ é‡åš "),f("button",{onClick:Cl,class:"next-btn",disabled:xl.value},p(xl.value?"â³ ç”Ÿæˆä¸­...":"â¡ï¸ ä¸‹ä¸€é¢˜ (ç©ºæ ¼)"),9,Me)])])):o("",!0)])])])):o("",!0)]),_:1})]))}},[["__scopeId","data-v-1d18e3d9"]]);export{Ce as default};
