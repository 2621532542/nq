var a=(a,e,l)=>new Promise((s,i)=>{var t=a=>{try{c(l.next(a))}catch(e){i(e)}},n=a=>{try{c(l.throw(a))}catch(e){i(e)}},c=a=>a.done?s(a.value):Promise.resolve(a.value).then(t,n);c((l=l.apply(a,e)).next())});import{I as e,c as l,r as s,w as i,o as t,a as n,q as c,e as u,i as v,s as r,b as d,v as o,u as g,f as p,t as m,F as y,l as h,n as f,T as k,y as w}from"./vendor.C2p1521c.js";import{_ as b,a as P,g as x}from"./index.BXZ9s8x4.js";const C={key:0,class:"discard-practice-overlay"},T={class:"discard-practice-container"},D={class:"practice-header"},_={class:"practice-stats"},E={class:"stat-item"},H={class:"practice-content"},R={key:0,class:"loading-state"},I={key:1,class:"hand-display"},S={class:"hand-label"},j={key:0},L={key:1,class:"result-correct"},Q={key:2,class:"result-wrong"},q={class:"tiles-row"},F=["onClick"],M=["src","alt"],V={key:0,class:"new-badge"},z={key:2,class:"result-section"},A={class:"result-comparison"},B={class:"result-item your-choice"},G={class:"result-tile"},J=["src","alt"],K={class:"result-info"},N={class:"ting-count"},O={class:"rank"},U={class:"result-tile"},W=["src","alt"],X={class:"result-info"},Y={class:"ting-count"},Z={class:"ting-comparison"},$={class:"ting-section"},aa={class:"ting-tiles"},ea=["src"],la={key:0,class:"no-ting"},sa={key:0,class:"ting-section"},ia={class:"ting-tiles"},ta=["src"],na=["disabled"],ca=b({__name:"DiscardPractice",setup(b){const ca=P(),{discardPracticeMode:ua,discardPracticeHand:va,discardPracticeRecommendations:ra}=e(ca),da=ua,oa=l(()=>{const a=va.value||[];if(a.length<=1)return a;const e=a.slice(0,-1),l=a[a.length-1];var s;return[...(s=e,[...s].sort((a,e)=>a-e)),l]}),ga=l(()=>ra.value||[]),pa=s(-1),ma=s(!1),ya=s(0),ha=s(0),fa=l(()=>pa.value>=0&&oa.value[pa.value]?oa.value[pa.value]:null),ka=l(()=>ga.value.length>0?ga.value[0].discardTile:null),wa=l(()=>ka.value?oa.value.findIndex(a=>a===ka.value):-1),ba=l(()=>fa.value===ka.value),Pa=l(()=>{if(!fa.value)return 0;const a=ga.value.findIndex(a=>a.discardTile===fa.value);return a>=0?a+1:ga.value.length+1}),xa=l(()=>{if(!fa.value)return 0;const a=ga.value.find(a=>a.discardTile===fa.value);return a?a.waitingCount:0}),Ca=l(()=>{if(!fa.value)return[];const a=ga.value.find(a=>a.discardTile===fa.value);return a?a.waitingTiles:[]}),Ta=l(()=>ga.value.length>0?ga.value[0].waitingCount:0),Da=l(()=>ga.value.length>0&&ga.value[0].waitingTiles||[]),_a=()=>{ma.value=!0,ya.value++,ba.value&&(ha.value++,ca.addExp(8)),Sa()},Ea=s(!1),Ha=s(!1),Ra=s(null),Ia=s(null),Sa=()=>a(null,null,function*(){try{const a=[...ca.discardPracticeHand],e=[...ca.discardPracticeRecommendations];yield ca.generateDiscardQuestion(),Ra.value=[...ca.discardPracticeHand],Ia.value=[...ca.discardPracticeRecommendations],ca.discardPracticeHand=a,ca.discardPracticeRecommendations=e,Ha.value=!0}catch(a){Ha.value=!1}}),ja=()=>a(null,null,function*(){if(ma.value=!1,pa.value=-1,Ha.value&&Ra.value&&Ia.value)return ca.discardPracticeHand=[...Ra.value],ca.discardPracticeRecommendations=[...Ia.value],Ha.value=!1,Ra.value=null,void(Ia.value=null);Ea.value=!0;try{yield ca.generateDiscardQuestion()}catch(a){}finally{Ea.value=!1}}),La=()=>{ca.exitDiscardPractice()};i(da,a=>{a&&(ya.value=0,ha.value=0,ma.value=!1,pa.value=-1)});const Qa=a=>{if(da.value)return"Escape"===a.code?(a.preventDefault(),void La()):void("Space"===a.code&&ma.value&&!Ea.value&&(a.preventDefault(),ja()))};return t(()=>{window.addEventListener("keydown",Qa)}),n(()=>{window.removeEventListener("keydown",Qa)}),(a,e)=>(u(),c(w,{to:"body"},[v(k,{name:"fade-scale"},{default:r(()=>[g(da)?(u(),d("div",C,[p("div",T,[p("div",D,[e[1]||(e[1]=p("h4",null,"ğŸ¯ èˆç‰Œç»ƒä¹ ",-1)),p("div",_,[p("span",E,m(ha.value)+"/"+m(ya.value)+" æ­£ç¡®",1),e[0]||(e[0]=p("span",{class:"stat-item hint"},"æŒ‰ç©ºæ ¼ä¸‹ä¸€é¢˜",-1)),p("button",{onClick:La,class:"exit-btn"},"âœ• é€€å‡º (ESC)")])]),p("div",H,[0===oa.value.length||Ea.value?(u(),d("div",R,e[2]||(e[2]=[p("span",null,"â³ æ­£åœ¨ç”Ÿæˆé¢˜ç›®...",-1)]))):oa.value.length>0&&!Ea.value?(u(),d("div",I,[p("div",S,[ma.value?ba.value?(u(),d("span",L,"âœ… æ­£ç¡®ï¼è¿™æ˜¯æœ€ä¼˜é€‰æ‹©")):(u(),d("span",Q,"âŒ å¯ä»¥æ›´å¥½")):(u(),d("span",j,"ç‚¹å‡»é€‰æ‹©è¦æ‰“å‡ºçš„ç‰Œï¼ˆå…±"+m(oa.value.length)+"å¼ ï¼‰",1))]),p("div",q,[(u(!0),d(y,null,h(oa.value,(a,e)=>(u(),d("div",{key:e,class:f(["tile-wrapper",{"new-tile":e===oa.value.length-1,selected:pa.value===e,best:ma.value&&wa.value===e,disabled:ma.value}]),onClick:a=>(a=>{ma.value||(pa.value=a,_a())})(e)},[p("img",{src:g(x)(a),alt:a,class:"tile-img"},null,8,M),e===oa.value.length-1?(u(),d("div",V,"æ‘¸")):o("",!0)],10,F))),128))])])):o("",!0),ma.value?(u(),d("div",z,[p("div",A,[p("div",B,[e[3]||(e[3]=p("div",{class:"result-label"},"ä½ çš„é€‰æ‹©",-1)),p("div",G,[p("img",{src:g(x)(fa.value),alt:fa.value},null,8,J)]),p("div",K,[p("span",N,m(xa.value)+"å¼ ",1),p("span",O,"ç¬¬"+m(Pa.value)+"å",1)])]),e[6]||(e[6]=p("div",{class:"vs"},"VS",-1)),p("div",{class:f(["result-item best-choice",{same:ba.value}])},[e[5]||(e[5]=p("div",{class:"result-label"},"æœ€ä¼˜é€‰æ‹©",-1)),p("div",U,[p("img",{src:g(x)(ka.value),alt:ka.value},null,8,W)]),p("div",X,[p("span",Y,m(Ta.value)+"å¼ ",1),e[4]||(e[4]=p("span",{class:"rank"},"ç¬¬1å",-1))])],2)]),p("div",Z,[p("div",$,[e[7]||(e[7]=p("div",{class:"ting-label"},"ä½ é€‰çš„å¬ç‰Œ:",-1)),p("div",aa,[(u(!0),d(y,null,h(Ca.value,a=>(u(),d("img",{key:a,src:g(x)(a),class:"ting-tile"},null,8,ea))),128)),0===Ca.value.length?(u(),d("span",la,"æ— å¬")):o("",!0)])]),ba.value?o("",!0):(u(),d("div",sa,[e[8]||(e[8]=p("div",{class:"ting-label"},"æœ€ä¼˜å¬ç‰Œ:",-1)),p("div",ia,[(u(!0),d(y,null,h(Da.value,a=>(u(),d("img",{key:a,src:g(x)(a),class:"ting-tile"},null,8,ta))),128))])]))]),p("button",{onClick:ja,class:"next-btn",disabled:Ea.value},m(Ea.value?"â³ ç”Ÿæˆä¸­...":"â¡ï¸ ä¸‹ä¸€é¢˜"),9,na)])):o("",!0)])])])):o("",!0)]),_:1})]))}},[["__scopeId","data-v-f63e13e8"]]);export{ca as default};
