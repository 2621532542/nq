var e=Object.defineProperty,t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,i=(t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,o=(e,o)=>{for(var u in o||(o={}))n.call(o,u)&&i(e,u,o[u]);if(t)for(var u of t(o))a.call(o,u)&&i(e,u,o[u]);return e};import{r as u,c as l,w as s,o as d,a as r,s as v,e as h,i as c,v as m,b as f,l as w,h as p,n as y,f as g,G as x,t as b,j as M,q as W,J as E,F as L,T as _,y as z}from"./vendor.G8ViXyKc.js";import{_ as $}from"./index.y6HLDFeu.js";const H={class:"header-left"},S={class:"window-icon"},N={class:"header-right"},X=["title"],I={class:"window-content"},O=$({__name:"FloatingWindow",props:{visible:{type:Boolean,default:!0},title:{type:String,default:"çª—å£"},icon:{type:String,default:"ðŸ“‹"},theme:{type:String,default:"purple"},storageKey:{type:String,default:""},defaultWidth:{type:Number,default:280},defaultHeight:{type:Number,default:300},defaultX:{type:Number,default:-1},defaultY:{type:Number,default:100},minWidth:{type:Number,default:180},minHeight:{type:Number,default:150},maxWidth:{type:Number,default:600},maxHeight:{type:Number,default:800},resizable:{type:Boolean,default:!0},minimizable:{type:Boolean,default:!0}},emits:["close"],setup(e,{emit:t}){void 0===window.__floatingWindowZIndex&&(window.__floatingWindowZIndex=1e3);const n=()=>++window.__floatingWindowZIndex,a=e,i=u(null),$=u({x:0,y:0}),O=u({width:a.defaultWidth,height:a.defaultHeight}),Y=u(!1),P=u(!1),j=u(!1),k=u(""),K=u({x:0,y:0}),T=u({x:0,y:0}),J=u({width:0,height:0}),C=u(n()),B=u(!1),D=u(!1),F=()=>{D.value=window.innerWidth<=480},Z=l(()=>{let e=O.value.width,t=window.innerWidth-20;return D.value&&(e=Math.min(e,t)),{left:`${$.value.x}px`,top:`${$.value.y}px`,width:Y.value?"160px":`${e}px`,height:Y.value?"auto":`${O.value.height}px`,maxWidth:D.value?`${t}px`:"none",maxHeight:D.value?"60vh":"none",zIndex:C.value}});function q(){const e=n();C.value<e&&(C.value=e,B.value=!0,setTimeout(()=>{B.value=!1},200))}function G(){if(F(),D.value){const e=window.innerWidth-20;return O.value={width:Math.min(a.defaultWidth,e,260),height:Math.min(a.defaultHeight,.5*window.innerHeight,300)},void($.value={x:Math.max(10,(window.innerWidth-O.value.width)/2),y:80})}if(a.storageKey){const t=localStorage.getItem(`${a.storageKey}_position`),n=localStorage.getItem(`${a.storageKey}_size`);if(t)try{const e=JSON.parse(t);$.value={x:Math.min(Math.max(0,e.x),window.innerWidth-100),y:Math.max(0,Math.min(e.y,window.innerHeight-100))}}catch(e){R()}else R();if(n)try{const e=JSON.parse(n);O.value={width:Math.min(Math.max(e.width,a.minWidth),a.maxWidth),height:Math.min(Math.max(e.height,a.minHeight),a.maxHeight)}}catch(e){}}else R()}function R(){a.defaultX>=0?$.value.x=a.defaultX:$.value.x=window.innerWidth-O.value.width-20,$.value.y=a.defaultY}function A(){a.storageKey&&(localStorage.setItem(`${a.storageKey}_position`,JSON.stringify($.value)),localStorage.setItem(`${a.storageKey}_size`,JSON.stringify(O.value)))}function Q(){Y.value=!Y.value}function U(){q(),Q()}function V(e){if(j.value)return;P.value=!0,q();const t=e.touches?e.touches[0].clientX:e.clientX,n=e.touches?e.touches[0].clientY:e.clientY;K.value={x:t,y:n},T.value=o({},$.value),document.addEventListener("mousemove",ee),document.addEventListener("mouseup",te),document.addEventListener("touchmove",ee,{passive:!1}),document.addEventListener("touchend",te)}function ee(e){if(!P.value)return;e.preventDefault();const t=e.touches?e.touches[0].clientX:e.clientX,n=e.touches?e.touches[0].clientY:e.clientY,a=t-K.value.x,i=n-K.value.y;let o=T.value.x+a,u=T.value.y+i;const l=Y.value?200:O.value.width;o=Math.max(0,Math.min(o,window.innerWidth-l)),u=Math.max(0,Math.min(u,window.innerHeight-50)),$.value={x:o,y:u}}function te(){P.value&&(P.value=!1,A()),document.removeEventListener("mousemove",ee),document.removeEventListener("mouseup",te),document.removeEventListener("touchmove",ee),document.removeEventListener("touchend",te)}function ne(e,t){t.stopPropagation(),j.value=!0,k.value=e,q();const n=t.touches?t.touches[0].clientX:t.clientX,a=t.touches?t.touches[0].clientY:t.clientY;K.value={x:n,y:a},J.value=o({},O.value),document.addEventListener("mousemove",ae),document.addEventListener("mouseup",ie),document.addEventListener("touchmove",ae,{passive:!1}),document.addEventListener("touchend",ie)}function ae(e){if(!j.value)return;e.preventDefault();const t=e.touches?e.touches[0].clientX:e.clientX,n=e.touches?e.touches[0].clientY:e.clientY,i=t-K.value.x,o=n-K.value.y;let u=J.value.width,l=J.value.height;k.value.includes("e")&&(u=Math.min(Math.max(J.value.width+i,a.minWidth),a.maxWidth)),k.value.includes("s")&&(l=Math.min(Math.max(J.value.height+o,a.minHeight),a.maxHeight)),O.value={width:u,height:l}}function ie(){j.value&&(j.value=!1,A()),document.removeEventListener("mousemove",ae),document.removeEventListener("mouseup",ie),document.removeEventListener("touchmove",ae),document.removeEventListener("touchend",ie)}return s(()=>a.visible,e=>{e&&(G(),q())}),d(()=>{F(),window.addEventListener("resize",F),a.visible&&G()}),r(()=>{te(),ie(),window.removeEventListener("resize",F)}),(t,n)=>(h(),v(z,{to:"body"},[c(_,{name:"window-fade"},{default:m(()=>[e.visible?(h(),f("div",{key:0,class:y(["floating-window",[`theme-${e.theme}`,{minimized:Y.value,"window-active":B.value}]]),style:p(Z.value),ref_key:"windowRef",ref:i,onMousedownCapture:q,onTouchstartCapture:q},[g("div",{class:y(["window-header",`header-${e.theme}`]),onMousedown:V,onTouchstartPassive:V,onDblclick:U},[g("div",H,[g("span",S,b(e.icon),1),g("h3",null,b(e.title),1)]),g("div",N,[M(t.$slots,"header-extra",{},void 0,!0),e.minimizable?(h(),f("button",{key:0,onClick:W(Q,["stop"]),class:"header-btn",title:Y.value?"å±•å¼€":"æœ€å°åŒ–"},b(Y.value?"â–¢":"â€”"),9,X)):w("",!0),g("button",{onClick:n[0]||(n[0]=W(e=>t.$emit("close"),["stop"])),class:"header-btn close-btn",title:"å…³é—­"},"âœ•")])],34),x(g("div",I,[M(t.$slots,"default",{},void 0,!0)],512),[[E,!Y.value]]),e.resizable&&!Y.value?(h(),f(L,{key:0},[g("div",{class:"resize-handle resize-se",onMousedown:n[1]||(n[1]=e=>ne("se",e)),onTouchstartPassive:n[2]||(n[2]=e=>ne("se",e))},null,32),g("div",{class:"resize-handle resize-e",onMousedown:n[3]||(n[3]=e=>ne("e",e)),onTouchstartPassive:n[4]||(n[4]=e=>ne("e",e))},null,32),g("div",{class:"resize-handle resize-s",onMousedown:n[5]||(n[5]=e=>ne("s",e)),onTouchstartPassive:n[6]||(n[6]=e=>ne("s",e))},null,32)],64)):w("",!0)],38)):w("",!0)]),_:3})]))}},[["__scopeId","data-v-0a4a0c35"]]);export{O as F};
