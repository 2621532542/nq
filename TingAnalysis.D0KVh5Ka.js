var e=Object.defineProperty,a=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,s=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l;import{r as n,c as i,o as r,a as o,b as u,e as c,f as d,t as v,n as p,v as y,F as f,l as m,u as g,k as h,E as b,w as k,G as w,H as _,m as C,q as x,s as A,g as T,T as z,h as P,y as I,j as q}from"./vendor.BQAVRTmg.js";import{_ as j,u as M,a as E,g as N,H as S,s as $,b as D,c as L,d as H,e as O,f as R,N as K,L as Q,h as U,i as X,j as F,k as B}from"./index.D0mN0E-X.js";const V={class:"tile-pool-wrapper"},G={class:"header-hint"},W={class:"tile-pool"},Y={key:0,class:"suit-tabs"},J=["onClick"],Z=["data-suit"],ee={class:"tile-row"},ae=["disabled","onClick","title"],te=["src","alt"],le={class:"tile-remain"},se=j({__name:"TilePool",emits:["tile-selected"],setup(e,{emit:a}){const t=a,{currentHand:l,addTile:s}=M(),h=E(),b=n("man"),k=n(!1),w=i({get:()=>h.tilePoolCollapsed,set:e=>h.tilePoolCollapsed=e}),_=[{key:"man",label:"ä¸‡",tiles:Array.from({length:9},(e,a)=>({code:a+1,name:`${a+1}ä¸‡`}))},{key:"pin",label:"ç­’",tiles:Array.from({length:9},(e,a)=>({code:a+11,name:`${a+1}ç­’`}))},{key:"sou",label:"æ¡",tiles:Array.from({length:9},(e,a)=>({code:a+21,name:`${a+1}æ¡`}))},{key:"honor",label:"å­—",tiles:[{code:31,name:"ä¸œ"},{code:32,name:"å—"},{code:33,name:"è¥¿"},{code:34,name:"åŒ—"},{code:35,name:"ä¸­"},{code:36,name:"å‘"},{code:37,name:"ç™½"}]}],C=i(()=>k.value?_.filter(e=>e.key===b.value):_),x=e=>l.value.filter(a=>a===e).length,A=()=>{const e=k.value;k.value=window.innerWidth<=768,!e&&k.value&&(w.value=!0)};return r(()=>{A(),window.addEventListener("resize",A)}),o(()=>{window.removeEventListener("resize",A)}),(e,a)=>(c(),u("div",V,[d("div",{class:"pool-header",onClick:a[0]||(a[0]=e=>w.value=!w.value)},[a[1]||(a[1]=d("span",{class:"header-icon"},"ğŸ€„",-1)),a[2]||(a[2]=d("span",{class:"header-title"},"é€‰ç‰ŒåŒº",-1)),d("span",G,v(w.value?"ç‚¹å‡»å±•å¼€":"ç‚¹å‡»æ”¶èµ·"),1),d("span",{class:p(["collapse-icon",{collapsed:w.value}])},"â–¼",2)]),d("div",{class:p(["tile-pool-collapse",{collapsed:w.value}])},[d("div",W,[k.value?(c(),u("div",Y,[(c(),u(f,null,m(_,e=>d("button",{key:e.key,class:p(["suit-tab",{active:b.value===e.key}]),onClick:a=>b.value=e.key},v(e.label),11,J)),64))])):y("",!0),d("div",{class:p(["pool-content",{mobile:k.value}])},[(c(!0),u(f,null,m(C.value,e=>(c(),u("div",{key:e.key,class:"tile-category","data-suit":e.key},[d("div",ee,[(c(!0),u(f,null,m(e.tiles,e=>(c(),u("button",{key:e.code,class:p(["tile-btn",{disabled:x(e.code)>=4}]),disabled:x(e.code)>=4,onClick:a=>{return n=e.code,void(l.value.length>=S.MAX?$("æ‰‹ç‰Œå·²æ»¡"):x(n)>=4?$("æ­¤ç‰Œå·²è¾¾åˆ°æœ€å¤§æ•°é‡"):(s(n),t("tile-selected",n)));var n},title:e.name},[d("img",{src:g(N)(e.code),alt:e.name},null,8,te),d("span",le,v(4-x(e.code)),1)],10,ae))),128))])],8,Z))),128))],2)])],2)]))}},[["__scopeId","data-v-232abb27"]]),ne={class:"quiz-overlay"},ie={class:"quiz-panel"},re={class:"quiz-timer"},oe={class:"quick-select",role:"group","aria-label":"å¬ç‰Œé€‰æ‹©"},ue=["aria-pressed","aria-label","onClick"],ce=["aria-pressed","aria-label"],de=j({__name:"QuizPanel",props:{elapsedTime:{type:[Number,String],default:0}},emits:["submit","prev","next"],setup(e,{emit:a}){const t=h("feedback",null),l=a,s=n(""),i=n(null),o=b(new Set),y=e=>{null==t||t.haptic.selection(),o.has(e)?o.delete(e):o.add(e),g()},g=()=>{const e=Array.from(o);e.sort((e,a)=>36===e?1:36===a?-1:e-a),s.value=e.join(",")},x=e=>{const a=new Set,t=e.split(/[,\s]+/).filter(e=>e.trim());for(const l of t){const e=l.trim();if("å‘"!==e&&"fa"!==e)if(/^\d+$/.test(e)){let t=0;for(;t<e.length;)if(t+1<e.length&&"36"===e.substring(t,t+2))a.add(36),t+=2;else{const l=parseInt(e[t]);l>=1&&l<=9&&a.add(l),t+=1}}else{const t=parseInt(e);36===t?a.add(36):t>=1&&t<=9&&a.add(t)}else a.add(36)}return a};k(s,e=>{const a=x(e);o.clear();for(const t of a)o.add(t)});const A=()=>{const e=x(s.value),a=Array.from(e).sort((e,a)=>36===e?1:36===a?-1:e-a);l("submit",a.join(","))},T=e=>{""===s.value.trim()&&("ArrowLeft"===e.code?(e.preventDefault(),s.value="",o.clear(),l("prev")):"ArrowRight"===e.code&&(e.preventDefault(),s.value="",o.clear(),l("next")))};return r(()=>{var e;null==(e=i.value)||e.focus()}),(a,t)=>(c(),u("div",ne,[d("div",ie,[t[2]||(t[2]=d("h4",null,"â“ é—®ç­”æ¨¡å¼",-1)),t[3]||(t[3]=d("p",{class:"quiz-hint"},"è¯·è¾“å…¥ä½ è®¤ä¸ºçš„å¬ç‰Œï¼ˆç‚¹å‡»é€‰æ‹©æˆ–æ‰‹åŠ¨è¾“å…¥ï¼‰",-1)),d("p",re,"â±ï¸ è®¡æ—¶ä¸­... "+v(e.elapsedTime)+"ç§’",1),d("div",oe,[(c(),u(f,null,m(9,e=>d("button",{key:e,class:p(["tile-btn",{selected:o.has(e)}]),"aria-pressed":o.has(e),"aria-label":`${e}ä¸‡${o.has(e)?"ï¼Œå·²é€‰ä¸­":""}`,onClick:a=>y(e)},v(e),11,ue)),64)),d("button",{class:p(["tile-btn tile-fa",{selected:o.has(36)}]),"aria-pressed":o.has(36),"aria-label":"å‘è´¢"+(o.has(36)?"ï¼Œå·²é€‰ä¸­":""),onClick:t[0]||(t[0]=e=>y(36))}," å‘ ",10,ce)]),w(d("input",{ref_key:"inputRef",ref:i,"onUpdate:modelValue":t[1]||(t[1]=e=>s.value=e),type:"text",class:"quiz-input",placeholder:"è¾“å…¥: 1234 æˆ– 336 æˆ– 1,2,3",onKeyup:C(A,["enter"]),onKeydown:T},null,544),[[_,s.value]]),d("button",{onClick:A,class:"btn btn-submit"}," âœ… å¯¹æ¯”ç­”æ¡ˆ ")])]))}},[["__scopeId","data-v-b58ba082"]]),ve={key:0,class:"celebration"},pe={class:"result-icon"},ye={class:"result-title"},fe={class:"quiz-duration"},me={class:"quiz-answers"},ge={class:"answer-row"},he={class:"answer-value user-answer"},be={class:"answer-row"},ke={class:"answer-value correct-answer"},we=j({__name:"QuizResult",props:{result:{type:Object,default:null}},emits:["next"],setup(e){const a=e,t=h("feedback",null);k(()=>a.result,e=>{e&&t&&(e.correct?t.haptic.success():t.haptic.error())},{immediate:!0});const l=e=>Array.isArray(e)?e.join(", "):e;return(a,t)=>(c(),x(z,{name:"result-pop"},{default:A(()=>[e.result?(c(),u("div",{key:0,class:p(["quiz-result-panel",{correct:e.result.correct,wrong:!e.result.correct}])},[e.result.correct?(c(),u("div",ve,t[1]||(t[1]=[d("span",{class:"confetti"},"ğŸ‰",-1),d("span",{class:"confetti"},"âœ¨",-1),d("span",{class:"confetti"},"ğŸŠ",-1)]))):y("",!0),d("div",pe,v(e.result.correct?"âœ…":"âŒ"),1),d("h4",ye,v(e.result.correct?"å›ç­”æ­£ç¡®ï¼":"å›ç­”é”™è¯¯"),1),d("p",fe,"â±ï¸ ç”¨æ—¶: "+v(e.result.duration)+" ç§’",1),d("div",me,[d("div",ge,[t[2]||(t[2]=d("span",{class:"answer-label"},"ä½ çš„ç­”æ¡ˆ:",-1)),d("span",he,v(l(e.result.userAnswer)||"æ— "),1)]),d("div",be,[t[3]||(t[3]=d("span",{class:"answer-label"},"æ­£ç¡®ç­”æ¡ˆ:",-1)),d("span",ke,v(l(e.result.correctAnswer)),1)])]),d("button",{onClick:t[0]||(t[0]=e=>a.$emit("next")),class:"btn btn-next"}," â¡ï¸ ä¸‹ä¸€é¢˜ "),t[4]||(t[4]=d("p",{class:"space-hint"},[T(" æŒ‰ "),d("kbd",null,"ç©ºæ ¼"),T(" é”®å¿«é€Ÿè¿›å…¥ä¸‹ä¸€é¢˜ ")],-1))],2)):y("",!0)]),_:1}))}},[["__scopeId","data-v-b9a2b178"]]),_e={class:"efficiency-chart"},Ce={class:"chart-container"},xe=["onClick","onMouseenter"],Ae={class:"discard-tile"},Te=["src","alt"],ze={key:0,class:"shanten-badge"},Pe={class:"bar-wrapper"},Ie={class:"bar-value"},qe={class:"wait-tiles"},je=["src","alt"],Me={class:"tooltip-title"},Ee={class:"tooltip-content"},Ne={key:0,class:"tooltip-shanten"},Se={key:1,class:"best-label"},$e=j({__name:"EfficiencyChart",props:{items:{type:Array,default:()=>[]}},setup(e){const r=e,{currentHand:o,removeTileByCode:h}=M(),b=n(-1),k=n(-1),w=n(0),_=n(0),C=i(()=>k.value<0?null:j.value[k.value]);function A(){k.value=-1}function z(e){q(e)}function q(e){w.value=e.clientX+15,_.value=e.clientY+10}const j=i(()=>{var e;return(null==(e=r.items)?void 0:e.length)?[...r.items].map(e=>{var n;return((e,n)=>{for(var i in n||(n={}))t.call(n,i)&&s(e,i,n[i]);if(a)for(var i of a(n))l.call(n,i)&&s(e,i,n[i]);return e})({id:e.id||Date.now()+Math.random(),discardTile:e.discardTile||e.key,waitingTiles:e.waitingTiles||e.value||[],waitingCount:e.waitingCount||e.tingCount||0,round:null!=(n=e.round)?n:99},e)}).sort((e,a)=>{var t,l;const s=null!=(t=e.round)?t:99,n=null!=(l=a.round)?l:99;return s!==n?s-n:S(a)-S(e)}):[]}),E=i(()=>0===j.value.length?1:Math.max(...j.value.map(e=>S(e)),1));function S(e){var a,t;return e.waitingCount||e.tingCount||(null==(a=e.waitingTiles)?void 0:a.length)||(null==(t=e.value)?void 0:t.length)||0}function H(e){return e.round}function O(e){return Math.round(S(e)/E.value*100)}function R(e){return e.waitingTiles||e.value||[]}function K(e){return 0===e?"rank-1":1===e?"rank-2":2===e?"rank-3":""}return(e,a)=>(c(),u("div",_e,[a[0]||(a[0]=d("h5",{class:"chart-title"},[T("ğŸ¯ ç‰Œæ•ˆå¯¹æ¯” "),d("span",{class:"hint"},"(ç‚¹å‡»æ‰“å‡º)")],-1)),d("div",Ce,[(c(!0),u(f,null,m(j.value,(e,a)=>(c(),u("div",{key:e.id||a,class:p(["chart-row",{best:0===a,selected:b.value===a}]),onClick:t=>function(e,a){const t=e.discardTile||e.key;o.value.includes(t)?(b.value=a,h(t),L(`æ‰“å‡º ${D(t)}`)):$("æ‰‹ç‰Œä¸­æ²¡æœ‰è¿™å¼ ç‰Œ")}(e,a),onMouseenter:e=>function(e,a){k.value=a,q(e)}(e,a),onMouseleave:A,onMousemove:z},[d("span",{class:p(["rank-badge",K(a)])},v(a+1),3),d("div",Ae,[d("img",{src:g(N)(e.discardTile||e.key),alt:g(D)(e.discardTile||e.key)},null,8,Te)]),void 0!==H(e)?(c(),u("div",ze,v(H(e))+"å‘å¬ ",1)):y("",!0),d("div",Pe,[d("div",{class:p(["bar",{"bar-best":0===a}]),style:P({width:O(e)+"%"})},[d("span",Ie,v(R(e).length)+"é—¨"+v(S(e))+"å¼ ",1)],6)]),d("div",qe,[(c(!0),u(f,null,m(R(e),e=>(c(),u("img",{key:e,src:g(N)(e),alt:g(D)(e),class:"wait-tile"},null,8,je))),128))])],42,xe))),128))]),(c(),x(I,{to:"body"},[k.value>=0&&C.value?(c(),u("div",{key:0,class:"tooltip",style:P({left:w.value+"px",top:_.value+"px"})},[d("div",Me,"æ‰“ "+v(g(D)(C.value.discardTile||C.value.key)),1),d("div",Ee,[void 0!==H(C.value)?(c(),u("div",Ne,v(H(C.value))+"å‘å¬ ",1)):y("",!0),d("div",null,v(R(C.value).length)+"é—¨"+v(S(C.value))+"å¼ è¿›å¼ ",1),0===k.value?(c(),u("div",Se,"âœ¨ æœ€ä¼˜é€‰æ‹©")):y("",!0)])],4)):y("",!0)]))]))}},[["__scopeId","data-v-11eae36a"]]),De={class:"empty-state"},Le={class:"empty-icon"},He={class:"empty-title"},Oe={key:0,class:"empty-description"},Re=j({__name:"EmptyState",props:{icon:{type:String,default:"ğŸ“­"},title:{type:String,default:"æš‚æ— æ•°æ®"},description:{type:String,default:""}},setup:e=>(a,t)=>(c(),u("div",De,[d("span",Le,v(e.icon),1),d("p",He,v(e.title),1),e.description?(c(),u("p",Oe,v(e.description),1)):y("",!0),q(a.$slots,"action",{},void 0)]))},[["__scopeId","data-v-11e29974"]]),Ke={class:"ting-analysis"},Qe={key:1,class:"analysis-controls"},Ue=["disabled"],Xe={key:1},Fe={key:2,class:"analysis-result"},Be={class:"result-header"},Ve={class:"status-icon"},Ge={key:2,class:"listening-info"},We={class:"listening-tiles"},Ye=["disabled","onClick","title"],Je=["src","alt"],Ze={class:"tile-name"},ea={class:"tile-remain"},aa={key:0,class:"ting-summary"},ta={class:"ting-stat"},la={class:"stat-value"},sa={class:"ting-stat"},na={class:"stat-value"},ia={key:4,class:"win-info"},ra=j({__name:"TingAnalysis",setup(e){const a=B("TingAnalysis"),{currentHand:t,isAnalyzing:l,analysisResult:s,analyzeHand:h,addTile:b,updateHand:A}=M(),{showPatternsList:z,showQuickInput:P}=H(),{quizMode:I,quizStartTime:q,quizResult:j,setQuizUserAnswer:V,checkQuizAnswer:G,wrongAnswersPracticeMode:W}=O(),{nextPattern:Y,prevPattern:J,randomFromPatterns:Z,selectedPatternsCount:ee}=R(),ae=E(),te=i(()=>ae.favoritesPracticeMode),le=i(()=>ee.value>0||W.value||te.value),ne=n(""),ie=n(0);let re=null;const oe=()=>{const e=ne.value.trim();if(e){const a=[],t=[{regex:/(\d+)m/gi,offset:0},{regex:/(\d+)p/gi,offset:10},{regex:/(\d+)s/gi,offset:20},{regex:/(\d+)z/gi,offset:30}];for(const{regex:l,offset:s}of t){let t;for(;null!==(t=l.exec(e));)for(const e of t[1]){const t=parseInt(e);t>=1&&t<=9&&a.push(t+s)}}a.length>0&&a.length<=14&&(A(a.sort((e,a)=>e-a)),ne.value="")}ge()},ue=()=>{re&&clearInterval(re),ie.value=0,re=setInterval(()=>{q.value&&(ie.value=((Date.now()-q.value)/1e3).toFixed(1))},100)},ce=()=>{re&&(clearInterval(re),re=null)};k(I,e=>{e?ue():ce()}),k(q,(e,a)=>{I.value&&e&&e!==a&&ue()});const ve=e=>{V(e),G(),ce()},pe=()=>{Y()},ye=e=>{if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName){if("Space"===e.code)return e.preventDefault(),void(I.value&&j.value?pe():ee.value>0&&Z());if("Enter"===e.code&&I.value&&!j.value)return e.preventDefault(),void ve();if("ArrowLeft"===e.code&&le.value)return e.preventDefault(),void J();if("ArrowRight"===e.code&&le.value)return e.preventDefault(),void Y();if(e.key>="1"&&e.key<="9"&&!e.ctrlKey&&!e.altKey&&!e.metaKey){const a=parseInt(e.key);return void b(a)}}};r(()=>{window.addEventListener("keydown",ye)}),o(()=>{window.removeEventListener("keydown",ye),ce()});const fe=i(()=>{if(!s.value)return!1;if(!(1===s.value.hu_type||"ready"===s.value.status))return!1;const e=t.value.length;return!K.includes(e)&&(s.value.ting_tiles||[]).length>0}),me=e=>t.value.filter(a=>a===e).length,ge=()=>{return e=null,l=null,s=function*(){if(ne.value){const e=(e=>{if("string"!=typeof e)return[];const a=[],t=e.split(/[,\sï¼Œ\-\/.ã€‚]+/).filter(Boolean).map((e,a)=>e.split("").map(Number).filter(e=>!isNaN(e)).map(e=>10*a+e));for(const l of t)a.push(...l);return a})(ne.value);A(e),ne.value=""}if(a.debug("å¼€å§‹åˆ†æ",t.value),t.value&&t.value.length>0)if(t.value.length>14)$("æ‰‹ç‰Œä¸èƒ½è¶…è¿‡14å¼ ");else try{const e=yield h();(null==e?void 0:e.success)?L("åˆ†æå®Œæˆ"):$((null==e?void 0:e.message)||"åˆ†æå¤±è´¥")}catch(e){a.error("åˆ†æé”™è¯¯:",e),$("åˆ†æè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯")}else $("è¯·å…ˆé€‰æ‹©æ‰‹ç‰Œ")},new Promise((a,t)=>{var n=e=>{try{r(s.next(e))}catch(a){t(a)}},i=e=>{try{r(s.throw(e))}catch(a){t(a)}},r=e=>e.done?a(e.value):Promise.resolve(e.value).then(n,i);r((s=s.apply(e,l)).next())});var e,l,s},he=e=>F(e),be=e=>{switch(e){case 0:return"â³";case 1:return"âœ…";case 2:return"ğŸ†";case 3:return"âš ï¸";default:return"â“"}};return(e,a)=>{var n,i,r;return c(),u("div",Ke,[g(z)?y("",!0):(c(),x(se,{key:0})),g(P)?(c(),u("div",Qe,[w(d("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>ne.value=e),class:"hand-input",placeholder:"å¿«æ·è¾“å…¥ç‰Œå‹ (å¦‚: 123m456p789s)",onKeyup:C(oe,["enter"])},null,544),[[_,ne.value]]),d("button",{onClick:oe,class:"btn btn-analyze",disabled:g(l)},[g(l)?(c(),x(Q,{key:0,size:"small"})):(c(),u("span",Xe,"ğŸ”")),T(" "+v(g(l)?"åˆ†æä¸­...":"åˆ†æ"),1)],8,Ue)])):y("",!0),g(s)?(c(),u("div",Fe,[g(I)&&!g(j)?(c(),x(de,{key:0,"elapsed-time":ie.value,onSubmit:ve,onPrev:g(J),onNext:g(Y)},null,8,["elapsed-time","onPrev","onNext"])):y("",!0),g(I)?(c(),x(we,{key:1,result:g(j),onNext:pe},null,8,["result"])):y("",!0),d("div",Be,[d("h4",null,"åˆ†æç»“æœ "+v(fe.value?g(U)(g(s)):""),1),d("div",{class:p(["result-status",(r=g(s).hu_type,X(r))])},[d("span",Ve,v(be(g(s).hu_type)),1),T(" "+v(he(g(s).hu_type)),1)],2)]),fe.value?(c(),u("div",Ge,[d("h5",null,"ğŸ¯ å¬ç‰Œ "+v(g(U)(g(s))),1),d("div",We,[(c(!0),u(f,null,m(g(s).ting_tiles||[],e=>(c(),u("button",{key:e,class:p(["listening-tile",{disabled:me(e)>=4}]),disabled:me(e)>=4,onClick:a=>{return l=e,void(t.value.length>=S.MAX?$("æ‰‹ç‰Œå·²æ»¡"):me(l)>=4?$("æ­¤ç‰Œå·²è¾¾åˆ°æœ€å¤§æ•°é‡"):b(l));var l},title:`ç‚¹å‡»æ·»åŠ  ${g(D)(e)}`},[d("img",{src:g(N)(e),alt:g(D)(e)},null,8,Je),d("span",Ze,v(g(D)(e)),1),d("span",ea,"ä½™"+v(4-me(e)),1)],10,Ye))),128))]),g(s).metadata||g(s).ting_count?(c(),u("div",aa,[d("div",ta,[a[1]||(a[1]=d("span",{class:"stat-label"},"è¿›å¬æ•°",-1)),d("span",la,v((null==(n=g(s).metadata)?void 0:n.round)||1)+"è¿›å¬",1)]),d("div",sa,[a[2]||(a[2]=d("span",{class:"stat-label"},"å¬ç‰Œæ•°",-1)),d("span",na,v((g(s).ting_tiles||[]).length)+"é—¨"+v(g(s).ting_count||0)+"å¼ ",1)])])):y("",!0)])):y("",!0),(null==(i=g(s).recommendations)?void 0:i.length)>0?(c(),x($e,{key:3,items:g(s).recommendations},null,8,["items"])):y("",!0),2===g(s).hu_type?(c(),u("div",ia,a[3]||(a[3]=[d("div",{class:"win-icon"},"ğŸ‰",-1),d("h5",null,"æ­å–œèƒ¡ç‰Œï¼",-1),d("p",null,"å½“å‰æ‰‹ç‰Œå·²ç»èƒ¡ç‰Œ",-1)]))):y("",!0)])):y("",!0),!g(s)&&g(t).length>0?(c(),x(Re,{key:3,icon:"ğŸ”",title:"ç‚¹å‡»åˆ†ææŸ¥çœ‹ç»“æœ",description:"é€‰å¥½æ‰‹ç‰Œåç‚¹å‡»åˆ†ææŒ‰é’®"})):y("",!0)])}}},[["__scopeId","data-v-9b7e8b9f"]]);export{ra as default};
