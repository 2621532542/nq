var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,r=(t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,i=(e,t)=>{for(var s in t||(t={}))n.call(t,s)&&r(e,s,t[s]);if(a)for(var s of a(t))l.call(t,s)&&r(e,s,t[s]);return e},o=(e,a)=>t(e,s(a)),u=(e,t,s)=>new Promise((a,n)=>{var l=e=>{try{i(s.next(e))}catch(t){n(t)}},r=e=>{try{i(s.throw(e))}catch(t){n(t)}},i=e=>e.done?a(e.value):Promise.resolve(e.value).then(l,r);i((s=s.apply(e,t)).next())});import{e as c,r as d,m as h,i as p,h as y,a as v,b as m,c as g,t as f,g as b,o as C,w,n as k,d as T,f as _,j as x,k as A,l as H,p as P,q as R,s as S,u as $,v as j,x as O,y as z,F as I,z as M,A as E,B as L,C as G,D as N,E as D,G as Z,H as q,I as F,J as B,K as U,L as W,T as V,M as J}from"./vendor.BE2uS7Mu.js";
/*!
 * pinia v3.0.3
 * (c) 2025 Eduardo San Martin Morote
 * @license MIT
 */
let K;!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const Y=e=>K=e,Q=Symbol();function X(e){return e&&"object"==typeof e&&"[object Object]"===Object.prototype.toString.call(e)&&"function"!=typeof e.toJSON}var ee,te;(te=ee||(ee={})).direct="direct",te.patchObject="patch object",te.patchFunction="patch function";const se=()=>{};function ae(e,t,s,a=se){e.push(t);const n=()=>{const s=e.indexOf(t);s>-1&&(e.splice(s,1),a())};return!s&&b()&&C(n),n}function ne(e,...t){e.slice().forEach(e=>{e(...t)})}const le=e=>e(),re=Symbol(),ie=Symbol();function oe(e,t){e instanceof Map&&t instanceof Map?t.forEach((t,s)=>e.set(s,t)):e instanceof Set&&t instanceof Set&&t.forEach(e.add,e);for(const s in t){if(!t.hasOwnProperty(s))continue;const a=t[s],n=e[s];X(n)&&X(a)&&e.hasOwnProperty(s)&&!m(a)&&!g(a)?e[s]=oe(n,a):e[s]=a}return e}const ue=Symbol();function ce(e){return!X(e)||!Object.prototype.hasOwnProperty.call(e,ue)}const{assign:de}=Object;function he(e){return!(!m(e)||!e.effect)}function pe(e,t,s={},a,n,l){let r;const i=de({actions:{}},s),o={deep:!0};let u,h,p,y=[],b=[];const C=a.state.value[e];let T;function _(t){let s;u=h=!1,"function"==typeof t?(t(a.state.value[e]),s={type:ee.patchFunction,storeId:e,events:p}):(oe(a.state.value[e],t),s={type:ee.patchObject,payload:t,storeId:e,events:p});const n=T=Symbol();k().then(()=>{T===n&&(u=!0)}),h=!0,ne(y,s,a.state.value[e])}l||C||(a.state.value[e]={}),d({});const x=l?function(){const{state:e}=s,t=e?e():{};this.$patch(e=>{de(e,t)})}:se;const A=(t,s="")=>{if(re in t)return t[ie]=s,t;const n=function(){Y(a);const s=Array.from(arguments),l=[],r=[];let i;ne(b,{args:s,name:n[ie],store:P,after:function(e){l.push(e)},onError:function(e){r.push(e)}});try{i=t.apply(this&&this.$id===e?this:P,s)}catch(o){throw ne(r,o),o}return i instanceof Promise?i.then(e=>(ne(l,e),e)).catch(e=>(ne(r,e),Promise.reject(e))):(ne(l,i),i)};return n[re]=!0,n[ie]=s,n},H={_p:a,$id:e,$onAction:ae.bind(null,b),$patch:_,$reset:x,$subscribe(t,s={}){const n=ae(y,t,s.detached,()=>l()),l=r.run(()=>w(()=>a.state.value[e],a=>{("sync"===s.flush?h:u)&&t({storeId:e,type:ee.direct,events:p},a)},de({},o,s)));return n},$dispose:function(){r.stop(),y=[],b=[],a._s.delete(e)}},P=v(H);a._s.set(e,P);const R=(a._a&&a._a.runWithContext||le)(()=>a._e.run(()=>(r=c()).run(()=>t({action:A}))));for(const c in R){const t=R[c];if(m(t)&&!he(t)||g(t))l||(C&&ce(t)&&(m(t)?t.value=C[c]:oe(t,C[c])),a.state.value[e][c]=t);else if("function"==typeof t){const e=A(t,c);R[c]=e,i.actions[c]=t}}return de(P,R),de(f(P),R),Object.defineProperty(P,"$state",{get:()=>a.state.value[e],set:e=>{_(t=>{de(t,e)})}}),a._p.forEach(e=>{de(P,r.run(()=>e({store:P,app:a._a,pinia:a,options:i})))}),C&&l&&s.hydrate&&s.hydrate(P.$state,C),u=!0,h=!0,P}
/*! #__NO_SIDE_EFFECTS__ */function ye(e,t,s){let a;const n="function"==typeof t;function l(s,l){const r=y();(s=s||(r?p(Q,null):null))&&Y(s),(s=K)._s.has(e)||(n?pe(e,t,a,s):function(e,t,s){const{state:a,actions:n,getters:l}=t,r=s.state.value[e];let i;i=pe(e,function(){r||(s.state.value[e]=a?a():{});const t=T(s.state.value[e]);return de(t,n,Object.keys(l||{}).reduce((t,a)=>(t[a]=h(_(()=>{Y(s);const t=s._s.get(e);return l[a].call(t,t)})),t),{}))},t,s,0,!0)}(e,a,s));return s._s.get(e)}return a=n?s:t,l.$id=e,l}const ve=new class{constructor(e=1e3){this.cache=new Map,this.maxSize=e}getCacheKey(e,t){return`${e.sort().join(",")}-${t}`}get(e,t){const s=this.getCacheKey(e,t);return this.cache.get(s)}set(e,t,s){const a=this.getCacheKey(e,t);if(this.cache.size>=this.maxSize){const e=this.cache.keys().next().value;this.cache.delete(e)}this.cache.set(a,o(i({},s),{cached:!0,timestamp:Date.now()}))}clear(){this.cache.clear()}};class me extends Error{constructor(e,t,s={}){super(t),this.name="MahjongAnalysisError",this.code=e,this.details=s}}const ge="INVALID_HAND",fe="INVALID_GAME_TYPE",be="ALGORITHM_ERROR",Ce="TIMEOUT";class we{constructor(e){this.type=e,this.useCards=[],this.laiZiCards=[]}}class ke{constructor(e,t){this.key=e,this.value=t}}class Te{constructor(){this.canPlayCards=[],this.needCards=[],this.tingCount=0,this.round=0,this.type=0,this.bestPlayCard=0,this.needCardGroups=[],this.gang=[]}}class _e{constructor(){this.playCardGroups=[],this.userCardCount=0,this.laiZiCardCount=0,this.laiZiCount=0,this.may=new Map,this.must=[],this.all=new Map}}function xe(e,t){if(0===t)return[[]];if(0===e.length)return[];const[s,...a]=e,n=xe(a,t),l=xe(a,t-1).map(e=>[s,...e]);return n.concat(l)}function Ae(e){if(e.length<2){if(1===e.length){const t=e[0],s=[];return s.push(t),t%10>1&&s.push(t-1),t%10<9&&s.push(t+1),s}return[]}const[t,s]=e,a=s-t,n=[];return 1===a?(t%10>1&&n.push(t-1),s%10<9&&n.push(s+1)):2===a&&n.push(t+1),n}function He(e,t,s){for(const a of e)if(a.useCards.includes(t)){const n=[...e],l=n.indexOf(a);n.splice(l,1);const r=[...a.useCards];r.splice(r.indexOf(t),1);const i=Ae(r),o=i.indexOf(t);o>-1&&i.splice(o,1);for(const e of i)s.add(e),He(n,e,s)}}function Pe(e,t,s){if(t>=38)return[];if(0===e[t])return Pe(e,t+1,s);if(!(t<30&&t%10!=9&&(e[t+1]>0||e[t+2]>0)))return je(e,t,s);const a=function(e,t,s){e=[...e];const a=new we(1);for(let l=0;l<3;l++){const s=t+l;e[s]>0?(e[s]--,a.useCards.push(s)):2===l&&t%10==8?a.laiZiCards.push(t-1):a.laiZiCards.push(s)}const n=[];if(0===a.laiZiCards.length&&t%10>1){const a=new we(1),l=[...e];l[t+2]++,a.useCards=[t,t+1],a.laiZiCards.push(t-1),$e(a,Pe(l,t,s),n)}return $e(a,Pe(e,t,s),n),n}(e,t,s),n=je(e,t,s);return a.concat(n)}function Re(e,t,s){if(t>=38)return[];if(0===e[t])return Re(e,t+1,s);if(!(t<30&&t%10!=9&&(e[t+1]>0||e[t+2]>0)))return Oe(e,t,s);const a=function(e,t,s){e=[...e];const a=new we(1);for(let l=0;l<3;l++){const s=t+l;e[s]>0?(e[s]--,a.useCards.push(s)):2===l&&t%10==8?a.laiZiCards.push(t-1):a.laiZiCards.push(s)}const n=[];if(0===a.laiZiCards.length&&t%10>1){const a=new we(1),l=[...e];l[t+2]++,a.useCards=[t,t+1],a.laiZiCards.push(t-1),$e(a,Re(l,t,s),n)}return $e(a,Re(e,t,s),n),n}(e,t,s),n=Oe(e,t,s);return a.concat(n)}function Se(e,t){if(0===t.length){const t=[[]];return t[0].push(e),t}for(const s of t)s.push(e);return t}function $e(e,t,s){if(0===t.length)s.push([e]);else for(const a of t)a.push(e),s.push(a)}function je(e,t,s){const a=(e=[...e])[t];e[t]=0;const n=[];if(4===a){e[t]=1;const a=new we(3);return a.useCards.push(t,t,t),Se(a,Pe(e,t,s))}if(3===a){const a=new we(3);if(a.useCards.push(t,t,t),$e(a,Pe(e,t+1,s),n),!s){const s=new we(2);s.useCards.push(t,t),e[t]=1,$e(s,Pe(e,t,!0),n)}}else if(2===a){const a=new we(3);if(a.useCards.push(t,t),a.laiZiCards.push(t),$e(a,Pe(e,t+1,s),n),!s){const s=new we(2);s.useCards.push(t,t),$e(s,Pe(e,t+1,!0),n)}}else if(1===a){const a=new we(3);if(a.useCards.push(t),a.laiZiCards.push(t,t),$e(a,Pe(e,t+1,s),n),!s){const s=new we(2);s.useCards.push(t),s.laiZiCards.push(t),$e(s,Pe(e,t+1,!0),n)}}return n}function Oe(e,t,s){const a=(e=[...e])[t];e[t]=0;const n=[];if(4===a){e[t]=1;const a=new we(3);return a.useCards.push(t,t,t),Se(a,Re(e,t,s))}if(3===a){const a=new we(3);if(a.useCards.push(t,t,t),$e(a,Re(e,t+1,s),n),!s&&[2,5,8].includes(t%10)){const s=new we(2);s.useCards.push(t,t),e[t]=1,$e(s,Re(e,t,!0),n)}}else if(2===a){const a=new we(3);if(a.useCards.push(t,t),a.laiZiCards.push(t),$e(a,Re(e,t+1,s),n),!s&&[2,5,8].includes(t%10)){const s=new we(2);s.useCards.push(t,t),$e(s,Re(e,t+1,!0),n)}}else if(1===a){const a=new we(3);if(a.useCards.push(t),a.laiZiCards.push(t,t),$e(a,Re(e,t+1,s),n),!s&&[2,5,8].includes(t%10)){const s=new we(2);s.useCards.push(t),s.laiZiCards.push(t),$e(s,Re(e,t+1,!0),n)}}return n}function ze(e,t){switch(t){case 0:case 3:default:return 41===e;case 2:return 35===e}}function Ie(e,t,s){let a=0;[1,4,7,10,13].includes(e.length)&&(a=1);const n=Math.floor(e.length/3)+1,l=Array(39).fill(0);let r=0;for(const v of e)ze(v,s)?r++:l[v]++;if(r===e.length){const e=new Te;return e.type=8,e}const i=function(e,t){const s=Array(39).fill(0);for(const a of e)ze(a,t)||s[a]++;return 3===t?Re(s,1,!1):Pe(s,1,!1)}(e,s);i.sort((e,t)=>e.length-t.length);let o=14;const u=[];for(const v of i){let e=0;const t=v.length-n,s=new Map;let a=!1;const l=[],i=new Map,c=new Map;let d=0;for(const n of v)d++,e+=n.laiZiCards.length,n.id=d,n.laiZiCards.length>0&&i.set(n.id,n),2!==n.type?(c.set(n.id,n),n.laiZiCards.length>0?s.set(n.id,n):0===n.laiZiCards.length&&1===n.type&&l.push(...n.useCards)):a=!0;if(e===r){const e=new Te;return e.round=0,e}if(a)if(t===i.size||0===s.size&&t===i.size||0===t){const t=new _e;t.playCardGroups=[],t.userCardCount=0,t.laiZiCardCount=0,t.laiZiCount=e,t.may=new Map(i),t.must=l,t.all=c,u.push(t),o=Math.min(o,e)}else if(t>0){const a=xe(Array.from(s.values()),t);for(const t of a){let s=0,a=0;const n=new Map(i),r=new Map(c);for(const e of t)s+=e.useCards.length,a+=e.laiZiCards.length,n.delete(e.id),r.delete(e.id);o=Math.min(o,s);const d=new _e;d.playCardGroups=t,d.userCardCount=s,d.laiZiCardCount=a,d.laiZiCount=e,d.may=n,d.must=l,d.all=r,u.push(d)}}}const c=new Map,d=new Set;let h=0;const p=[];for(const v of u){const e=o;if(a>0&&1===o&&0===v.playCardGroups.length&&(o=0),v.userCardCount<=e&&v.laiZiCount-v.laiZiCardCount===v.userCardCount+a+r){for(const t of v.playCardGroups)for(const e of t.useCards)c.set(e,(c.get(e)||0)+1);const e=new Set;for(const t of v.may.values())if(e.add(...t.laiZiCards),t.useCards[0]<30){const s=Math.floor(t.useCards[0]/10),a=[];for(const e of v.all.values())e.id!==t.id&&Math.floor(e.useCards[0]/10)===s&&3!==e.type&&a.push(e);if(1===t.type){if(1===t.laiZiCards.length){const s=Ae(t.useCards);for(const t of s)e.add(t),He(a,t,e)}}else if(2===t.type)1===t.laiZiCards.length&&He(a,t.useCards[0],e);else if(3===t.type&&2===t.laiZiCards.length){const s=t.useCards[0],n=[],l=s%10;l-2>0&&n.push(s-2),l-1>0&&n.push(s-1),l+1<10&&n.push(s+1),l+2<10&&n.push(s+2);for(const t of n)e.add(t),He(a,t,e)}}for(const t of e)l[t]<4?d.add(t):h=t;p.push(v)}}const y=new Te;if(y.targetResults=p,h>0&&0!==o)y.type=9,y.needCards=[h],y.tingCount=t[h]||0;else{y.needCards=Array.from(d),y.needCards.sort((e,t)=>e-t),y.canPlayCards=Array.from(c.keys());let e=0;for(const s of y.needCards)e+=t[s]||0;y.tingCount=e,a>0?(y.type=1,c.size>0&&(y.type=7)):o>0&&(y.type=7),y.round=o}return y}function Me(e,t,s=0){if([3,6,9,12].includes(e.length)){const e=new Te;return e.type=2,e}const a=Ie(e,t,s);if(8===a.type||9===a.type)return a;if([1,4,7,10,13].includes(e.length))return 13===e.length&&(a.round=0,a.needCards&&a.needCards.length>0?a.type=1:a.type=0),a.needCardGroups=[],a.canPlayCards=[],a;if(0===a.round)return a.type=4,a;if(a.canPlayCards&&a.canPlayCards.length>0){const n=Array(39).fill(0);for(const t of e)41!==t&&n[t]++;const l=[];for(const i of a.canPlayCards||[])if(4===n[i])a.type=9,a.gang=a.gang||[],a.gang.push(i);else if(9!==a.type){const n=[...e],r=n.indexOf(i);n.splice(r,1);const o=Ie(n,t,s);let u=0;if(o.needCards&&0!==o.needCards.length)for(const e of o.needCards||[])u+=t[e];else{o.needCards=[...a.needCards];for(const e of o.needCards)u+=t[e]}o.tingCount=u,o.bestPlayCard=i,l.push(o)}if(9===a.type)return a.needCards=a.gang,a;l.sort((e,t)=>{const s=t.needCards?t.needCards.length:0,a=e.needCards?e.needCards.length:0;if(s!==a)return s-a;const l=t.tingCount||0,r=e.tingCount||0;if(l!==r)return l-r;const i=(n[t.bestPlayCard-1]||0)+(n[t.bestPlayCard+1]||0),o=(n[e.bestPlayCard-1]||0)+(n[e.bestPlayCard+1]||0);return i!==o?o-i:Math.abs(t.bestPlayCard%10-5)-Math.abs(e.bestPlayCard%10-5)});const r=[];for(const e of l){const t=new ke;t.key=e.bestPlayCard,t.value=[...e.needCards||[]],t.tingCount=e.tingCount||0,t.round=e.round||0,r.push(t)}a.needCardGroups=r,a.type=5,a.needCardGroups.length>0&&(a.bestPlayCard=a.needCardGroups[0].key)}return a}class Ee{static analyze(e){return u(this,arguments,function*(e,t={},s=0,a={}){if(this.validateInput(e,s),!1!==a.useCache){const t=ve.get(e,s);if(t)return this.adaptResult(t,!0)}try{const n=Me(e,t,parseInt(s));return!1!==a.useCache&&ve.set(e,s,n),this.adaptResult(n,!1)}catch(n){throw new me(be,`算法分析失败: ${n.message}`,{originalError:n,cards:e,gameType:s})}})}static validateInput(e,t){if(!Array.isArray(e))throw new me(ge,"手牌必须是数组",{cards:e});if(e.length>14)throw new me(ge,"手牌不能超过14张",{length:e.length});const s=[0,2,3];if(!s.includes(parseInt(t)))throw new me(fe,`无效的游戏类型: ${t}`,{gameType:t,validTypes:s})}static adaptResult(e,t=!1){const s=this.mapStatus(e.type);return{status:s,statusCode:e.type,statusText:this.getStatusText(s),tingCards:e.needCards||[],tingCount:e.tingCount||0,recommendations:this.mapRecommendations(e.needCardGroups||[]),gangCards:e.gang||[],metadata:{round:e.round||0,originalType:e.type,algorithm:"loji",cached:t,timestamp:Date.now(),canPlayCards:e.canPlayCards||[]}}}static mapStatus(e){switch(e){case 0:case 3:case 8:return"not_ready";case 1:case 5:case 7:case 9:return"ready";case 2:return"xiaoxianggong";case 4:return"winning";default:return"unknown"}}static getStatusText(e){return{not_ready:"无法胡牌",ready:"听牌",xiaoxianggong:"小相公",winning:"已胡牌",unknown:"未知状态"}[e]||"未知状态"}static mapRecommendations(e){return e&&0!==e.length?e.map((e,t)=>({id:t+1,discardTile:e.key,waitingTiles:e.value||[],waitingCount:e.tingCount||0,round:e.round||0,priority:t+1,description:this.getRecommendationDescription(e)})):[]}static getRecommendationDescription(e){const t=(e.value||[]).length,s=e.tingCount||0,a=e.round||0;return a>=2?`可进${a}听，听${t}门${s}张`:`可听${t}门${s}张`}static clearCache(){ve.clear()}static getCacheInfo(){return{size:ve.cache.size,maxSize:ve.maxSize}}}const Le=14,Ge=4,Ne=[2,5,8,11,14],De=0,Ze=2,qe=3;function Fe(e){return""}function Be(e){if(e>=1&&e<=9)return`${e}万`;if(e>=11&&e<=19)return e-10+"筒";if(e>=21&&e<=29)return e-20+"条";if(e>=31&&e<=37){return["","东","南","西","北","中","发","白"][e-30]}return`未知牌${e}`}function Ue(e){const t=document.createElement("div");t.style.cssText="\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    background: #d4edda;\n    color: #155724;\n    padding: 12px 20px;\n    border-radius: 4px;\n    border: 1px solid #c3e6cb;\n    z-index: 10000;\n    font-size: 14px;\n    max-width: 300px;\n    box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n  ",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},2e3)}function We(e){const t=document.createElement("div");t.style.cssText="\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    background: #f8d7da;\n    color: #721c24;\n    padding: 12px 20px;\n    border-radius: 4px;\n    border: 1px solid #f5c6cb;\n    z-index: 10000;\n    font-size: 14px;\n    max-width: 300px;\n    box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n  ",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},3e3)}function Ve(e){return"string"==typeof e?function(e){switch(e){case"not_ready":return"status-not-ready";case"ready":return"status-ready";case"winning":return"status-win";case"xiaoxianggong":return"status-xiaoxianggong";default:return"status-unknown"}}(e):function(e){switch(e){case 0:return"status-not-ready";case 1:return"status-ready";case 2:return"status-win";case 3:return"status-xiaoxianggong";default:return"status-unknown"}}(e)}function Je(e){return"string"==typeof e?function(e){switch(e){case"not_ready":return"无法胡牌";case"ready":return"听牌";case"winning":return"已胡牌";case"xiaoxianggong":return"小相公";default:return"未知状态"}}(e):function(e){switch(e){case 0:return"无法胡牌";case 1:return"听牌";case 2:return"已胡牌";case 3:return"小相公";default:return"未知状态"}}(e)}function Ke(e){var t;if(!e)return"";const s=e.ting_tiles||e.tingCards||[],a=e.ting_count||e.tingCount||0,n=(null==(t=e.metadata)?void 0:t.round)||0;if(0===s.length)return"";let l="";return l+=n>=2?`(${n}进听`:"(听",l+=`${s.length}门${a}张)`,l}const Ye=ye("mahjong",{state:()=>({currentHand:[],gameType:"2",lastAddedIndex:-1,isAnalyzing:!1,analysisResult:null,comparisonResult:null,handHistory:[],autoAnalyze:!1,showAlgorithmTest:!1,showGoCommandAnalysis:!1,showLojiAnalysis:!0,showHandHistory:!1,selectedTiles:[],availableTiles:[],tingRecommendations:[]}),getters:{gameTypeName:e=>{switch(e.gameType){case"0":return"普通麻将";case"2":return"红中麻将";case"3":return"258麻将";default:return"未知类型"}},tileCount:e=>t=>e.selectedTiles.filter(e=>e===t).length,canAddTile:e=>e.currentHand.length<Le,canAnalyze:e=>{const t=e.currentHand&&e.currentHand.length>0,s=e.selectedTiles&&e.selectedTiles.length>0;return(t||s)&&!e.isAnalyzing},historyEmpty:e=>0===e.handHistory.length},actions:{addTile(e){this.currentHand.length>=Le?We("手牌已满"):(this.currentHand.push(e),this.syncHandToSelectedTiles(),this.currentHand.sort((e,t)=>e-t),this.lastAddedIndex=this.currentHand.lastIndexOf(e),this.autoAnalyze&&this.analyzeHand())},removeTile(e){if(e>=0&&e<this.currentHand.length)return this.currentHand.splice(e,1),this.lastAddedIndex=-1,void(this.autoAnalyze&&this.analyzeHand());We("无效的索引")},addRandomTile(){if(this.currentHand.length>=Le)return void We("手牌已满");const e=[];for(let s=1;s<=9;s++)e.push(s);for(let s=11;s<=19;s++)e.push(s);for(let s=21;s<=29;s++)e.push(s);for(let s=31;s<=37;s++)e.push(s);const t=e[Math.floor(Math.random()*e.length)];this.addTile(t)},generateRandomHand(){this.currentHand=[],this.lastAddedIndex=-1;for(let e=0;e<Le;e++)this.addRandomTile();this.autoAnalyze&&this.analyzeHand()},clearHand(){this.currentHand=[],this.lastAddedIndex=-1,this.analysisResult=null,this.comparisonResult=null},updateHand(e){this.currentHand=[...e],this.lastAddedIndex=-1,this.autoAnalyze&&this.analyzeHand()},analyzeHand(){return u(this,null,function*(){if(this.currentHand&&0!==this.currentHand.length)if(this.isAnalyzing)We("正在分析中，请稍候");else{this.isAnalyzing=!0,this.analysisResult=null;try{const e=this.createCardMap(),t=yield Promise.race([Ee.analyze(this.currentHand,e,this.gameType,{useCache:!0}),new Promise((e,t)=>setTimeout(()=>t(new me(Ce,"分析超时")),1e4))]),s=this.adaptStandardResult(t);return this.analysisResult=s,this.addToHistory(this.currentHand,s),{success:!0,result:s}}catch(e){this.analysisResult=null;let t="分析失败";if(e instanceof me)switch(e.code){case Ce:t="分析超时，请重试";break;case ge:t=`手牌无效：${e.message}`;break;case fe:t=`游戏类型错误：${e.message}`;break;default:t=e.message}else t=e.message||"未知错误";We(t)}finally{this.isAnalyzing=!1}}else We("请先选择手牌")})},validateHand(){if(!Array.isArray(this.currentHand))return{valid:!1,error:"手牌数据无效"};if(0===this.currentHand.length)return{valid:!1,error:"请选择手牌"};if(this.currentHand.length>Le)return{valid:!1,error:`手牌不能超过${Le}张`};for(let t=0;t<this.currentHand.length;t++){const e=this.currentHand[t];if("number"!=typeof e||e<1||e>41)return{valid:!1,error:`第${t+1}张牌无效: ${e}`}}const e={};for(const t of this.currentHand)if(e[t]=(e[t]||0)+1,e[t]>4)return{valid:!1,error:`${t}这张牌数量过多（超过4张）`};return{valid:!0}},createCardMap(){const e=Array(42).fill(4);for(const t of this.currentHand)t>=1&&t<=37&&(e[t]=Math.max(0,e[t]-1));return e},adaptStandardResult(e){return e?{hu_type:this.mapStandardStatus(e.status),status:e.status,statusText:e.statusText,ting_tiles:e.tingCards||[],ting_count:e.tingCount||0,recommendations:e.recommendations||[],gang_cards:e.gangCards||[],metadata:e.metadata||{},_standard_result:e}:null},mapStandardStatus(e){switch(e){case"not_ready":default:return 0;case"ready":return 1;case"winning":return 2;case"xiaoxianggong":return 3}},processAnalysisResult(e){if(!e)return null;return{hu_type:this.mapResultType(e.type),ting_tiles:e.needCards||[],recommendations:this.mapRecommendations(e.needCardGroups||[]),original_result:e}},mapResultType(e){switch(e){case 1:case 5:return 1;case 2:return 3;case 4:case 8:return 2;default:return 0}},mapRecommendations:e=>e&&0!==e.length?e.map(e=>({key:e.key,value:e.value||[],round:e.round||1,tingCount:e.tingCount||0})):[],addToHistory(e,t){const s={id:Date.now(),hand:[...e],result:t,gameType:this.gameType,timestamp:(new Date).toLocaleString()};this.handHistory.unshift(s),this.handHistory.length>50&&(this.handHistory=this.handHistory.slice(0,50))},clearHistory(){this.handHistory=[]},loadFromHistory(e){this.currentHand=[...e.hand],this.gameType=e.gameType,this.analysisResult=e.result,this.lastAddedIndex=-1},toggleAutoAnalyze(){this.autoAnalyze=!this.autoAnalyze},toggleAlgorithmTest(){this.showAlgorithmTest=!this.showAlgorithmTest},toggleGoCommandAnalysis(){this.showGoCommandAnalysis=!this.showGoCommandAnalysis},toggleLojiAnalysis(){this.showLojiAnalysis=!this.showLojiAnalysis},toggleHandHistory(){this.showHandHistory=!this.showHandHistory},setGameType(e){this.gameType=e,this.autoAnalyze&&this.currentHand.length>0&&this.analyzeHand()},setSelectedTiles(e){this.selectedTiles=[...e]},addSelectedTile(e){this.selectedTiles.length>=Le?We("手牌已满"):(this.selectedTiles.push(e),this.selectedTiles.sort((e,t)=>e-t))},removeSelectedTile(e){e>=0&&e<this.selectedTiles.length?this.selectedTiles.splice(e,1):We("无效的索引")},syncSelectedTilesToHand(){this.currentHand=[...this.selectedTiles],this.lastAddedIndex=-1,this.autoAnalyze&&this.analyzeHand()},syncHandToSelectedTiles(){this.selectedTiles=[...this.currentHand]},copyCurrentHand(){return u(this,null,function*(){try{const e=this.currentHand.join(",");yield navigator.clipboard.writeText(e),Ue("手牌已复制到剪贴板")}catch(e){We("复制失败")}})}}});function Qe(){const e=Ye();return{currentHand:_(()=>e.currentHand),gameType:_(()=>e.gameType),gameTypeName:_(()=>e.gameTypeName),isAnalyzing:_(()=>e.isAnalyzing),analysisResult:_(()=>e.analysisResult),comparisonResult:_(()=>e.comparisonResult),lastAddedIndex:_(()=>e.lastAddedIndex),canAddTile:_(()=>e.canAddTile),canAnalyze:_(()=>e.canAnalyze),addTile:t=>e.addTile(t),removeTile:t=>e.removeTile(t),addRandomTile:()=>e.addRandomTile(),generateRandomHand:()=>e.generateRandomHand(),clearHand:()=>e.clearHand(),updateHand:t=>e.updateHand(t),analyzeHand:()=>e.analyzeHand(),copyCurrentHand:()=>e.copyCurrentHand(),setGameType:t=>e.setGameType(t)}}function Xe(){const e=Ye();return{handHistory:_(()=>e.handHistory),historyEmpty:_(()=>e.historyEmpty),addToHistory:(t,s)=>e.addToHistory(t,s),clearHistory:()=>e.clearHistory(),loadFromHistory:t=>e.loadFromHistory(t)}}function et(){const e=Ye();return{autoAnalyze:_(()=>e.autoAnalyze),showAlgorithmTest:_(()=>e.showAlgorithmTest),showGoCommandAnalysis:_(()=>e.showGoCommandAnalysis),showLojiAnalysis:_(()=>e.showLojiAnalysis),showHandHistory:_(()=>e.showHandHistory),toggleAutoAnalyze:()=>e.toggleAutoAnalyze(),toggleAlgorithmTest:()=>e.toggleAlgorithmTest(),toggleGoCommandAnalysis:()=>e.toggleGoCommandAnalysis(),toggleLojiAnalysis:()=>e.toggleLojiAnalysis(),toggleHandHistory:()=>e.toggleHandHistory()}}const tt=d(!1),st=d(!1);let at=null,nt=null;const lt=d("light"),rt={light:{name:"浅色主题",icon:"☀️"},dark:{name:"深色主题",icon:"🌙"},auto:{name:"跟随系统",icon:"🔄"}},it="app-theme-mode";function ot(){let e=!1;switch(lt.value){case"dark":e=!0;break;case"light":e=!1;break;case"auto":e=st.value}if(tt.value=e,"undefined"!=typeof document){const t=document.documentElement;t.classList.remove("dark","light"),e?t.classList.add("dark"):t.classList.add("light"),function(e){if("undefined"==typeof document)return;const t=document.documentElement;e?(t.style.setProperty("--color-primary","#4a9eff"),t.style.setProperty("--color-primary-hover","#357abd"),t.style.setProperty("--color-success","#48bb78"),t.style.setProperty("--color-warning","#ed8936"),t.style.setProperty("--color-error","#f56565"),t.style.setProperty("--color-info","#4299e1"),t.style.setProperty("--color-background","#1a1a1a"),t.style.setProperty("--color-surface","#2d3748"),t.style.setProperty("--color-surface-hover","#4a5568"),t.style.setProperty("--color-border","#4a5568"),t.style.setProperty("--color-divider","#2d3748"),t.style.setProperty("--bg-primary","#1a1a1a"),t.style.setProperty("--bg-secondary","#2d3748"),t.style.setProperty("--bg-tertiary","#4a5568"),t.style.setProperty("--bg-quaternary","#2d3748"),t.style.setProperty("--bg-quinary","#4a5568"),t.style.setProperty("--border-color","#4a5568"),t.style.setProperty("--text-color","#e2e8f0"),t.style.setProperty("--text-secondary","#a0aec0"),t.style.setProperty("--color-text-primary","#e2e8f0"),t.style.setProperty("--color-text-secondary","#a0aec0"),t.style.setProperty("--color-text-muted","#718096"),t.style.setProperty("--color-text-inverse","#1a202c"),t.style.setProperty("--shadow-sm","0 1px 2px 0 rgba(0, 0, 0, 0.4)"),t.style.setProperty("--shadow-md","0 4px 6px -1px rgba(0, 0, 0, 0.4)"),t.style.setProperty("--shadow-lg","0 10px 15px -3px rgba(0, 0, 0, 0.4)")):(t.style.setProperty("--color-primary","#3498db"),t.style.setProperty("--color-primary-hover","#2980b9"),t.style.setProperty("--color-success","#2ecc71"),t.style.setProperty("--color-warning","#f39c12"),t.style.setProperty("--color-error","#e74c3c"),t.style.setProperty("--color-info","#17a2b8"),t.style.setProperty("--color-background","#ffffff"),t.style.setProperty("--color-surface","#f8f9fa"),t.style.setProperty("--color-surface-hover","#e9ecef"),t.style.setProperty("--color-border","#e1e5e9"),t.style.setProperty("--color-divider","#dee2e6"),t.style.setProperty("--bg-primary","#ffffff"),t.style.setProperty("--bg-secondary","#f8f9fa"),t.style.setProperty("--bg-tertiary","#e9ecef"),t.style.setProperty("--bg-quaternary","#f8f9fa"),t.style.setProperty("--bg-quinary","#e9ecef"),t.style.setProperty("--border-color","#e1e5e9"),t.style.setProperty("--text-color","#2c3e50"),t.style.setProperty("--text-secondary","#495057"),t.style.setProperty("--color-text-primary","#2c3e50"),t.style.setProperty("--color-text-secondary","#495057"),t.style.setProperty("--color-text-muted","#6c757d"),t.style.setProperty("--color-text-inverse","#ffffff"),t.style.setProperty("--shadow-sm","0 1px 2px 0 rgba(0, 0, 0, 0.05)"),t.style.setProperty("--shadow-md","0 4px 6px -1px rgba(0, 0, 0, 0.1)"),t.style.setProperty("--shadow-lg","0 10px 15px -3px rgba(0, 0, 0, 0.1)"))}(e)}}function ut(){const e=["light","dark","auto"],t=(e.indexOf(lt.value)+1)%e.length;lt.value=e[t]}function ct(e){["light","dark","auto"].includes(e)&&(lt.value=e)}function dt(){return rt[lt.value]}function ht(){x(()=>{"undefined"!=typeof window&&(at=window.matchMedia("(prefers-color-scheme: dark)"),st.value=at.matches,nt=e=>{st.value=e.matches,ot()},at.addEventListener("change",nt)),function(){if("undefined"!=typeof localStorage){const e=localStorage.getItem(it);e&&["light","dark","auto"].includes(e)&&(lt.value=e)}}(),ot()});const e=()=>{at&&nt&&at.removeEventListener("change",nt)};return A(()=>{e()}),w(lt,()=>{ot(),"undefined"!=typeof localStorage&&localStorage.setItem(it,lt.value)}),w(st,()=>{"auto"===lt.value&&ot()}),{isDark:tt,isSystemDark:st,themeMode:lt,THEME_CONFIG:rt,toggleTheme:ut,setThemeMode:ct,getCurrentThemeConfig:dt,cleanup:e,currentThemeIcon:()=>dt().icon,currentThemeName:()=>dt().name}}const pt=(e,t)=>{const s=e.__vccOpts||e;for(const[a,n]of t)s[a]=n;return s},yt={class:"theme-toggle"},vt=["title"],mt={class:"theme-icon"},gt={class:"theme-text"},ft=["onClick"],bt={class:"option-icon"},Ct={class:"option-content"},wt={class:"option-name"},kt={class:"option-desc"},Tt={key:0,class:"option-check"},_t=pt({__name:"ThemeToggle",setup(e){const{isDark:t,themeMode:s,THEME_CONFIG:a,setThemeMode:n,currentThemeIcon:l,currentThemeName:r}=ht(),i=d(!1);function o(e){return{light:"明亮清晰，适合白天使用",dark:"深色护眼，减少眼部疲劳",work:"低调商务，适合办公场所",auto:"自动跟随系统设置"}[e]||""}function u(e){e.target.closest(".theme-toggle")||(i.value=!1)}function c(e){"Escape"===e.key&&(i.value=!1)}return x(()=>{document.addEventListener("click",u),document.addEventListener("keydown",c)}),A(()=>{document.removeEventListener("click",u),document.removeEventListener("keydown",c)}),(e,u)=>(P(),H("div",yt,[R("button",{onClick:u[0]||(u[0]=e=>i.value=!i.value),class:"theme-toggle-btn",title:`当前: ${j(r)()}, 点击切换主题`},[R("span",mt,$(j(l)()),1),R("span",gt,$({light:"日间",dark:"护眼",work:"办公",auto:"自动"}[s.value]||"主题"),1),R("span",{class:O(["theme-indicator",{dark:j(t)}])},null,2)],8,vt),i.value?(P(),H("div",{key:0,class:"theme-dropdown",onClick:u[1]||(u[1]=z(()=>{},["stop"]))},[u[2]||(u[2]=R("div",{class:"dropdown-header"},"选择主题",-1)),(P(!0),H(I,null,M(j(a),(e,t)=>(P(),H("div",{key:t,class:O(["theme-option",{active:j(s)===t}]),onClick:e=>function(e){n(e),i.value=!1}(t)},[R("span",bt,$(e.icon),1),R("div",Ct,[R("div",wt,$(e.name),1),R("div",kt,$(o(t)),1)]),j(s)===t?(P(),H("span",Tt,"✓")):S("",!0)],10,ft))),128))])):S("",!0)]))}},[["__scopeId","data-v-1f4b46ed"]]),xt={class:"toolbar-container"},At={class:"control-group basic"},Ht={class:"control-group advanced"},Pt={class:"game-type-selector"},Rt={class:"control-group tools"},St={class:"control-group history"},$t=["disabled"],jt=pt({__name:"ToolBar",setup(e){const{gameType:t,addRandomTile:s,generateRandomHand:a,clearHand:n,copyCurrentHand:l,setGameType:r}=Qe(),{autoAnalyze:i,showAlgorithmTest:o,showGoCommandAnalysis:u,showLojiAnalysis:c,showHandHistory:d,toggleAutoAnalyze:h,toggleAlgorithmTest:p,toggleGoCommandAnalysis:y,toggleLojiAnalysis:v,toggleHandHistory:m}=et(),{historyEmpty:g,clearHistory:f}=Xe(),b=_({get:()=>t.value,set:e=>r(e)});return(e,t)=>(P(),H("div",xt,[R("div",At,[R("button",{onClick:t[0]||(t[0]=(...e)=>j(a)&&j(a)(...e)),class:"btn btn-primary"}," 🎲 随机 "),R("button",{onClick:t[1]||(t[1]=(...e)=>j(s)&&j(s)(...e)),class:"btn btn-success"}," ➕ 加一 "),R("button",{onClick:t[2]||(t[2]=(...e)=>j(l)&&j(l)(...e)),class:"btn btn-warning"}," 📋 复制 "),R("button",{onClick:t[3]||(t[3]=(...e)=>j(n)&&j(n)(...e)),class:"btn btn-secondary"}," 🗑️ 清空 ")]),R("div",Ht,[R("button",{onClick:t[4]||(t[4]=(...e)=>j(h)&&j(h)(...e)),class:O(["btn",j(i)?"btn-success":"btn-outline"])},$(j(i)?"🔍 自动分析开":"🔍 自动分析关"),3),R("div",Pt,[E(R("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>b.value=e),class:"game-type-select"},t[11]||(t[11]=[R("option",{value:"0"},"普通",-1),R("option",{value:"2"},"红中",-1),R("option",{value:"3"},"258",-1)]),512),[[L,b.value]])])]),R("div",Rt,[R("button",{onClick:t[6]||(t[6]=(...e)=>j(p)&&j(p)(...e)),class:"btn btn-info"}," 📊 "+$(j(o)?"隐藏算法测试":"算法对比测试"),1),R("button",{onClick:t[7]||(t[7]=(...e)=>j(y)&&j(y)(...e)),class:"btn btn-success"}," 🚀 "+$(j(u)?"隐藏Go分析":"Go命令分析"),1),R("button",{onClick:t[8]||(t[8]=(...e)=>j(v)&&j(v)(...e)),class:"btn btn-info"}," 🎯 "+$(j(c)?"隐藏Loji分析":"Loji听牌分析"),1)]),R("div",St,[R("button",{onClick:t[9]||(t[9]=(...e)=>j(f)&&j(f)(...e)),class:"btn btn-warning",disabled:j(g)}," 🗑️ 清空历史记录 ",8,$t),R("button",{onClick:t[10]||(t[10]=(...e)=>j(m)&&j(m)(...e)),class:"btn btn-outline"}," 📜 "+$(j(d)?"隐藏历史":"显示历史"),1)])]))}},[["__scopeId","data-v-2b380cf7"]]),Ot={class:"app-header"},zt={class:"header-content"},It={class:"toolbar-section"},Mt={class:"header-actions"},Et=pt({__name:"Header",setup:e=>(e,t)=>(P(),H("header",Ot,[R("div",zt,[R("div",It,[G(jt)]),R("div",Mt,[G(_t)])])]))},[["__scopeId","data-v-fc79b1de"]]),Lt={class:"main-content"},Gt={class:"content-container"},Nt=pt({__name:"MainContent",setup:e=>(e,t)=>(P(),H("main",Lt,[R("div",Gt,[N(e.$slots,"default",{},void 0)])]))},[["__scopeId","data-v-88fbbfa7"]]),Dt={class:"hand-display-footer"},Zt={class:"footer-content"},qt={class:"selected-tiles"},Ft=["onClick"],Bt=["src","alt"],Ut=pt({__name:"Footer",setup(e){const{currentHand:t,removeTile:s}=Qe();return(e,a)=>(P(),H("footer",Dt,[R("div",Zt,[R("div",qt,[(P(!0),H(I,null,M(j(t),(e,t)=>(P(),H("div",{key:t,class:"selected-tile",onClick:e=>j(s)(t)},[R("img",{src:j(Fe)(e),alt:j(Be)(e)},null,8,Bt)],8,Ft))),128))])])]))}},[["__scopeId","data-v-79863605"]]),Wt={class:"history-panel"},Vt={class:"panel-header"},Jt={key:0,class:"empty-history"},Kt={key:1,class:"history-list"},Yt=["onClick"],Qt={class:"history-header"},Xt={class:"history-time"},es={class:"history-stats"},ts={class:"tile-count"},ss={class:"game-type"},as={class:"history-hand"},ns={class:"hand-tiles"},ls=["src","alt"],rs={key:0,class:"history-analysis"},is={key:0,class:"ting-info"},os={key:2,class:"history-actions"},us=pt({__name:"HistoryPanel",setup(e){const{handHistory:t,historyEmpty:s,clearHistory:a,loadFromHistory:n}=Xe(),{toggleHandHistory:l}=et(),r=e=>{switch("string"==typeof e?parseInt(e):e){case De:return"普通";case Ze:return"红中";case qe:return"258";default:return"未知"}},i=e=>Je(e);return(e,o)=>(P(),H("div",Wt,[R("div",Vt,[R("h3",null,"📜 手牌历史记录 ("+$(j(t).length)+"/50)",1),R("button",{onClick:o[0]||(o[0]=(...e)=>j(l)&&j(l)(...e)),class:"close-btn"},"×")]),j(s)?(P(),H("div",Jt,o[2]||(o[2]=[R("p",null,"暂无历史记录",-1),R("small",null,"分析手牌后会自动保存到历史记录中",-1)]))):(P(),H("div",Kt,[(P(!0),H(I,null,M(j(t),e=>{return P(),H("div",{key:e.id,class:"history-item",onClick:t=>j(n)(e)},[R("div",Qt,[R("span",Xt,$(e.timestamp),1),R("div",es,[R("span",ts,$(e.hand.length)+"张牌",1),R("span",ss,$(r(e.gameType)),1)])]),R("div",as,[R("div",ns,[(P(!0),H(I,null,M(e.hand.slice(0,14),(e,t)=>(P(),H("img",{key:t,src:j(Fe)(e),alt:j(Be)(e),class:"tile-img"},null,8,ls))),128))])]),e.result?(P(),H("div",rs,[R("span",{class:O(["analysis-status",(t=e.result.hu_type,Ve(t))])},$(i(e.result.hu_type)),3),e.result.ting_tiles&&e.result.ting_tiles.length>0?(P(),H("span",is," 听"+$(e.result.ting_tiles.length)+"张 ",1)):S("",!0)])):S("",!0)],8,Yt);var t}),128))])),j(s)?S("",!0):(P(),H("div",os,[R("button",{onClick:o[1]||(o[1]=(...e)=>j(a)&&j(a)(...e)),class:"btn btn-danger"}," 🗑️ 清空历史记录 ")]))]))}},[["__scopeId","data-v-af5ccfab"]]),cs="http://127.0.0.1:8000";function ds(e){return u(this,arguments,function*(e,t=3,s=1e3){try{return yield e()}catch(a){if(t>0)return yield new Promise(e=>setTimeout(e,s)),ds(e,t-1,s);throw a}})}function hs(e){return u(this,arguments,function*(e,t={}){return ds(()=>u(this,null,function*(){try{const s=yield function(e,t={},s=1e4){return new Promise((a,n)=>{const l=setTimeout(()=>{n(new Error(`请求超时: ${s}ms`))},s);fetch(e,t).then(e=>{clearTimeout(l),a(e)}).catch(e=>{clearTimeout(l),n(e)})})}(`${cs}/analyze`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hand:e,config:t})});if(!s.ok){const e=yield s.text();throw new Error(`HTTP ${s.status}: ${e||s.statusText}`)}const a=yield s.json();return o(i({},a),{raw_response:a,request_info:{url:`${cs}/analyze`,method:"POST",hand:e,options:t,timestamp:(new Date).toISOString()}})}catch(s){throw s}})).catch(e=>({error:e.message,status:"error",results:{},details:{error_type:e.name,error_message:e.message,traceback:e.stack}}))})}function ps(e){return u(this,arguments,function*(e,t={}){const s=performance.now();try{if(!function(e){if(!e||!Array.isArray(e)||0===e.length)return!1;if(e.length>14)return!1;for(const s of e)if(!Number.isInteger(s)||s<1||s>41)return!1;const t={};for(const s of e)if(t[s]=(t[s]||0)+1,t[s]>4)return!1;return!0}(e))throw new Error("手牌格式不合法");const a=yield hs(e,t),n=performance.now()-s,l={};a.results&&"object"==typeof a.results?Object.keys(a.results).forEach(e=>{a.results[e]&&(l[e]=o(i({},a.results[e]),{_source:"python-backend",_raw_response:a}))}):a.error&&(l["mahjong-repository"]={library:"mahjong-repository",status:"error",execution_time:0,error:a.error,details:a.details||{},_source:"python-backend",_raw_response:a});const r=Object.values(l).filter(e=>e&&"success"===e.status).length,u=Object.keys(l).length,c=r>0?Object.values(l).filter(e=>e&&"success"===e.status&&"number"==typeof e.execution_time).reduce((e,t)=>e+t.execution_time,0)/r:0,d=Object.values(l).filter(e=>e&&"success"===e.status&&null!==e.shanten&&void 0!==e.shanten).map(e=>e.shanten);return{hand:e,results:l,summary:{total_libraries:u,successful_calculations:r,failed_calculations:u-r,available_libraries:u,average_execution_time:c,total_execution_time:n,consistency:{shanten_values:[...new Set(d)],consensus_shanten:ys(l)},analysis_options:t},timestamp:(new Date).toISOString(),locale_timestamp:(new Date).toLocaleString("zh-CN")}}catch(a){return{hand:e,results:{},error:{message:a.message,type:a.name,stack:a.stack},summary:{total_libraries:0,successful_calculations:0,available_libraries:0,average_execution_time:0,error_occurred:!0},timestamp:(new Date).toISOString(),locale_timestamp:(new Date).toLocaleString("zh-CN")}}})}function ys(e){const t=Object.values(e).filter(e=>"success"===e.status&&null!==e.shanten&&void 0!==e.shanten).map(e=>e.shanten);if(0===t.length)return null;const s={};t.forEach(e=>{s[e]=(s[e]||0)+1});let a=0,n=null;return Object.entries(s).forEach(([e,t])=>{t>a&&(a=t,n=parseInt(e))}),n}const vs={class:"algorithm-test"},ms={class:"control-panel"},gs=["disabled"],fs=["disabled"],bs=["disabled"],Cs=["disabled"],ws=["disabled"],ks={class:"test-config"},Ts=["disabled"],_s=["disabled"],xs={class:"test-options"},As={class:"options-grid"},Hs=["disabled"],Ps=["disabled"],Rs=["disabled"],Ss={key:0,class:"progress-section"},$s={class:"progress-bar"},js={class:"progress-info"},Os={key:0},zs={class:"stats-grid"},Is={class:"stat-card"},Ms={class:"stat-value"},Es={class:"stat-card success"},Ls={class:"stat-value"},Gs={key:0,class:"stat-percent"},Ns={class:"stat-card warning"},Ds={class:"stat-value"},Zs={key:0,class:"stat-percent"},qs={class:"stat-card error"},Fs={class:"stat-value"},Bs={key:0,class:"stat-percent"},Us={class:"stat-card"},Ws={class:"stat-value"},Vs={class:"stat-card"},Js={class:"stat-value"},Ks={key:1,class:"error-logs"},Ys={class:"log-list"},Qs={class:"log-time"},Xs={class:"log-message"},ea=["onClick"],ta={key:2,class:"discrepancies-section"},sa={class:"count"},aa={class:"discrepancy-stats"},na={class:"pattern-grid"},la={class:"pattern-title"},ra={class:"pattern-count"},ia={class:"pattern-percent"},oa={class:"discrepancies-list"},ua=["onClick"],ca={class:"expand-icon"},da={class:"disc-content"},ha={class:"hand-display"},pa={class:"hand-array"},ya={class:"results"},va={key:0,class:"result-item"},ma={class:"value"},ga={key:1,class:"result-item"},fa={class:"value"},ba={key:0,class:"disc-details"},Ca={class:"detail-grid"},wa={class:"detail-item"},ka={class:"detail-item"},Ta={class:"detail-item"},_a=["onClick"],xa={class:"error-detail"},Aa={key:0},Ha=pt({__name:"AlgorithmTest",setup(e){const t=d(!1),s=d(!1),a=d(200),n=d(50),l=d(null),r=d(null),i=d({}),o=d(!1),c=v({usePythonBackend:!0,useNiuAlgorithm:!0,showRealtimeResults:!1}),h=d({tested:0,matches:0,discrepancies:0,errors:0}),p=d([]),y=d([]),m=ps,g=d(!1),f=d(null);x(()=>u(this,null,function*(){}));const b=_(()=>a.value>0?h.value.tested/a.value*100:0),C=_(()=>p.value.slice(-20).reverse()),k=_(()=>y.value.slice(-10).reverse()),T=_(()=>{if(!l.value||0===h.value.tested)return"0";const e=(Date.now()-l.value)/1e3;return Math.floor(h.value.tested/e).toString()}),A=_(()=>{if(!l.value)return"00:00";const e=Math.floor((Date.now()-l.value)/1e3),t=e%60;return`${Math.floor(e/60).toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`}),j=_(()=>{if(!l.value||0===h.value.tested)return"--";const e=(Date.now()-l.value)/1e3,t=h.value.tested/e,s=(a.value-h.value.tested)/t;if(s<60)return`${Math.floor(s)}秒`;return`${Math.floor(s/60)}:${Math.floor(s%60).toString().padStart(2,"0")}`}),L=_(()=>{const e={};return p.value.forEach(t=>{const s=G(t);e[s]||(e[s]={count:0,title:s}),e[s].count++}),Object.values(e).forEach(e=>{e.percent=(e.count/p.value.length*100).toFixed(1)}),e});function G(e){var t,s;const a=null==(s=null==(t=e.pythonResults)?void 0:t["mahjong-repository"])?void 0:s.shanten,n=e.niuAlgorithmResult;return void 0!==a&&void 0!==n?a!==n?`Python:${a} vs Niu:${n}`:"结果一致":void 0!==a?"Python有结果，Niu无结果":void 0!==n?"Niu有结果，Python无结果":"两者都无结果"}function N(){const e=[],t=[];for(let s=1;s<=9;s++)for(let e=0;e<4;e++)t.push(s);for(let s=11;s<=19;s++)for(let e=0;e<4;e++)t.push(s);for(let s=21;s<=29;s++)for(let e=0;e<4;e++)t.push(s);for(let s=31;s<=37;s++)for(let e=0;e<4;e++)t.push(s);for(let s=0;s<14;s++){const s=Math.floor(Math.random()*t.length);e.push(t[s]),t.splice(s,1)}return e.sort((e,t)=>e-t)}function U(e){const t=[];for(const s of e)if(s>=1&&s<=9)t.push(s+"万");else if(s>=11&&s<=19)t.push(s-10+"筒");else if(s>=21&&s<=29)t.push(s-20+"条");else if(s>=31&&s<=37){const e=["东","南","西","北","白","发","中"];t.push(e[s-31])}return t.join(" ")}function W(e){return u(this,null,function*(){var t;const s={hand:e,results:{},niuAlgorithmResult:void 0,errors:[]};try{if(c.usePythonBackend)try{const t=yield m(e);t&&t.results?Object.keys(t.results).forEach(e=>{t.results[e]&&void 0!==t.results[e].shanten&&(s.results[e]=t.results[e].shanten)}):t.error&&s.errors.push({library:"python-backend",error:t.error})}catch(a){s.errors.push({library:"python-backend",error:a.message})}if(c.useNiuAlgorithm)try{const t=e.map(e=>e-1),a=Me(t,Array(37).fill(4),0);a&&void 0!==a.round?s.niuAlgorithmResult=a.round:s.errors.push({library:"niuAlgorithm",error:"No valid result"})}catch(a){s.errors.push({library:"niuAlgorithm",error:a.message})}const n=Object.values(s.results).filter(e=>null!=e),l=void 0!==s.niuAlgorithmResult;if(n.length>=1||l){const a=null==(t=s.results["mahjong-repository"])?void 0:t.shanten,n=s.niuAlgorithmResult;let l=!1;void 0!==a&&void 0!==n&&a!==n&&(l=!0),l?(h.value.discrepancies++,p.value.push({number:h.value.discrepancies,hand:e,handStr:U(e),pythonResults:s.results,niuAlgorithmResult:s.niuAlgorithmResult,timestamp:(new Date).toLocaleTimeString()})):h.value.matches++,c.showRealtimeResults}else h.value.errors++,y.value.push({time:(new Date).toLocaleTimeString(),message:"分析失败: 没有有效结果",hand:e,results:s.results,niuAlgorithmResult:s.niuAlgorithmResult,errors:s.errors})}catch(a){h.value.errors++,y.value.push({time:(new Date).toLocaleTimeString(),message:a.message,hand:e,stack:a.stack})}h.value.tested++})}const V=[{id:1,name:"标准听牌",hand:[1,1,1,2,3,4,5,6,7,11,11,11,31],expected:{shanten:0,isWinning:!1,winningTiles:[2,5,8]}},{id:2,name:"已胡牌型",hand:[1,1,1,2,2,2,3,3,3,4,4,4,5,5],expected:{shanten:-1,isWinning:!0,winType:"标准和牌"}},{id:3,name:"七对子听牌",hand:[1,1,3,3,5,5,7,7,11,11,13,13,31],expected:{shanten:0,isWinning:!1,winType:"七对子听牌"}},{id:4,name:"国士无双听牌",hand:[1,9,11,19,21,29,31,32,33,34,35,36,37],expected:{shanten:0,isWinning:!1,winType:"国士无双听牌"}},{id:5,name:"一向听经典",hand:[1,2,3,4,5,6,8,9,11,12,13,21,21,22],expected:{shanten:1,isWinning:!1,winType:"1向听"}},{id:6,name:"二向听复杂",hand:[1,3,5,7,9,12,14,16,23,25,27,31,33,35],expected:{shanten:2,isWinning:!1,winType:"2向听"}},{id:7,name:"边界测试",hand:[1,1,1,1,9,9,9,9,31,31,31,31,37,37],expected:{shanten:3,isWinning:!1,winType:"特殊构造"}},{id:8,name:"特别牌型",hand:[1,2,3,3,12,14,15,15,16,18,23,29,32,34],expected:{shanten:3,isWinning:!1,winType:"特别牌型"}}];function J(){return u(this,null,function*(){if(!t.value||s.value)return;const e=[];o.value||(yield function(){return u(this,null,function*(){const e=[];for(const t of V)e.push(W(t.hand));yield Promise.all(e),o.value=!0})}());const l=Math.min(n.value,a.value-h.value.tested);for(let t=0;t<l;t++){const t=N();e.push(W(t))}yield Promise.all(e),t.value&&!s.value&&h.value.tested<a.value?requestAnimationFrame(()=>{J()}):h.value.tested>=a.value&&function(){t.value=!1,s.value=!1;Ue(`测试完成！\n已测试: ${h.value.tested}\n完全一致: ${h.value.matches} (${(h.value.matches/h.value.tested*100).toFixed(2)}%)\n发现差异: ${h.value.discrepancies} (${(h.value.discrepancies/h.value.tested*100).toFixed(2)}%)\n错误: ${h.value.errors} (${(h.value.errors/h.value.tested*100).toFixed(2)}%)\n用时: ${A.value}`)}()})}function K(){c.usePythonBackend||c.useNiuAlgorithm?(t.value=!0,s.value=!1,l.value=Date.now(),h.value={tested:0,matches:0,discrepancies:0,errors:0},p.value=[],y.value=[],i.value={},o.value=!1,J()):showError("请至少启用一个算法进行测试")}function Y(){s.value=!s.value,!s.value&&t.value&&J()}function Q(){t.value=!1,s.value=!1,r.value&&(clearTimeout(r.value),r.value=null)}function X(){h.value={tested:0,matches:0,discrepancies:0,errors:0},p.value=[],y.value=[],i.value={},l.value=null,o.value=!1}function ee(){const e={summary:{totalTested:h.value.tested,matches:h.value.matches,discrepancies:h.value.discrepancies,errors:h.value.errors,matchRate:(h.value.matches/h.value.tested*100).toFixed(2)+"%",timestamp:(new Date).toISOString(),testDuration:A.value,testOptions:c},discrepancyPatterns:L.value,discrepancies:p.value,errorLogs:y.value},t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=`algorithm-test-results-${(new Date).toISOString().split("T")[0]}.json`,a.click(),URL.revokeObjectURL(s)}function te(){g.value=!1,f.value=null}return D(()=>{r.value&&clearTimeout(r.value)}),w(c,()=>{c.usePythonBackend||c.useNiuAlgorithm||(c.usePythonBackend=!0)}),(e,l)=>{var r;return P(),H("div",vs,[l[33]||(l[33]=R("div",{class:"test-header"},[R("h2",null,"算法对比测试"),R("p",{class:"description"}," 对比 Python后端(MahjongRepository) 和 niuAlgorithm 的向听数计算结果 ")],-1)),R("div",ms,[R("button",{class:"btn btn-primary",onClick:K,disabled:t.value},$(t.value?"测试中...":"开始测试"),9,gs),R("button",{class:"btn btn-secondary",onClick:Y,disabled:!t.value},$(s.value?"继续":"暂停"),9,fs),R("button",{class:"btn btn-danger",onClick:Q,disabled:!t.value}," 停止测试 ",8,bs),R("button",{class:"btn btn-secondary",onClick:X,disabled:t.value||0===p.value.length}," 清除结果 ",8,Cs),R("button",{class:"btn btn-success",onClick:ee,disabled:0===p.value.length}," 导出结果 ",8,ws),R("div",ks,[R("label",null,[l[6]||(l[6]=Z(" 测试数量： ")),E(R("input",{type:"number","onUpdate:modelValue":l[0]||(l[0]=e=>a.value=e),min:"100",max:"100000",step:"100",disabled:t.value},null,8,Ts),[[q,a.value,void 0,{number:!0}]])]),R("label",null,[l[7]||(l[7]=Z(" 批次大小： ")),E(R("input",{type:"number","onUpdate:modelValue":l[1]||(l[1]=e=>n.value=e),min:"10",max:"1000",step:"10",disabled:t.value},null,8,_s),[[q,n.value,void 0,{number:!0}]])])])]),R("div",xs,[l[11]||(l[11]=R("h3",null,"测试选项",-1)),R("div",As,[R("label",null,[E(R("input",{type:"checkbox","onUpdate:modelValue":l[2]||(l[2]=e=>c.usePythonBackend=e),disabled:t.value},null,8,Hs),[[F,c.usePythonBackend]]),l[8]||(l[8]=Z(" 使用 Python 后端 (MahjongRepository) "))]),R("label",null,[E(R("input",{type:"checkbox","onUpdate:modelValue":l[3]||(l[3]=e=>c.useNiuAlgorithm=e),disabled:t.value},null,8,Ps),[[F,c.useNiuAlgorithm]]),l[9]||(l[9]=Z(" 使用 niuAlgorithm (JavaScript) "))]),R("label",null,[E(R("input",{type:"checkbox","onUpdate:modelValue":l[4]||(l[4]=e=>c.showRealtimeResults=e),disabled:t.value},null,8,Rs),[[F,c.showRealtimeResults]]),l[10]||(l[10]=Z(" 显示实时结果 "))])])]),h.value.tested>0||t.value?(P(),H("div",Ss,[R("div",$s,[R("div",{class:O(["progress-fill",{paused:s.value}]),style:B({width:b.value+"%"})},$(b.value.toFixed(1))+"% ",7)]),R("div",js,[R("span",null,$(h.value.tested)+" / "+$(a.value),1),"--"!==j.value?(P(),H("span",Os,"预计剩余时间: "+$(j.value),1)):S("",!0)])])):S("",!0),R("div",zs,[R("div",Is,[R("div",Ms,$(h.value.tested),1),l[12]||(l[12]=R("div",{class:"stat-label"},"已测试",-1))]),R("div",Es,[R("div",Ls,$(h.value.matches),1),l[13]||(l[13]=R("div",{class:"stat-label"},"完全一致",-1)),h.value.tested>0?(P(),H("div",Gs,$((h.value.matches/h.value.tested*100).toFixed(1))+"% ",1)):S("",!0)]),R("div",Ns,[R("div",Ds,$(h.value.discrepancies),1),l[14]||(l[14]=R("div",{class:"stat-label"},"发现差异",-1)),h.value.tested>0?(P(),H("div",Zs,$((h.value.discrepancies/h.value.tested*100).toFixed(1))+"% ",1)):S("",!0)]),R("div",qs,[R("div",Fs,$(h.value.errors),1),l[15]||(l[15]=R("div",{class:"stat-label"},"错误",-1)),h.value.tested>0?(P(),H("div",Bs,$((h.value.errors/h.value.tested*100).toFixed(1))+"% ",1)):S("",!0)]),R("div",Us,[R("div",Ws,$(T.value),1),l[16]||(l[16]=R("div",{class:"stat-label"},"速度(手/秒)",-1))]),R("div",Vs,[R("div",Js,$(A.value),1),l[17]||(l[17]=R("div",{class:"stat-label"},"已用时间",-1))])]),y.value.length>0?(P(),H("div",Ks,[l[18]||(l[18]=R("h3",null,"错误日志 (最新 10 条)",-1)),R("div",Ys,[(P(!0),H(I,null,M(k.value,(e,t)=>(P(),H("div",{key:t,class:"log-item"},[R("span",Qs,$(e.time),1),R("span",Xs,$(e.message),1),R("button",{onClick:t=>{return s=e,f.value=s,void(g.value=!0);var s},class:"btn-link"},"详情",8,ea)]))),128))])])):S("",!0),p.value.length>0?(P(),H("div",ta,[R("h3",null,[l[19]||(l[19]=Z(" 发现的差异 ")),R("span",sa,"(总计: "+$(p.value.length)+", 显示最新 "+$(Math.min(20,p.value.length))+" 个)",1)]),R("div",aa,[l[20]||(l[20]=R("h4",null,"差异模式分析",-1)),R("div",na,[(P(!0),H(I,null,M(L.value,(e,t)=>(P(),H("div",{key:t,class:"pattern-card"},[R("div",la,$(e.title),1),R("div",ra,$(e.count)+" 次",1),R("div",ia,$(e.percent)+"%",1)]))),128))])]),R("div",oa,[(P(!0),H(I,null,M(C.value,(e,t)=>{var s;return P(),H("div",{key:t,class:O(["discrepancy-item",{expanded:i.value[e.number]}])},[R("div",{class:"disc-header",onClick:t=>{return s=e.number,void(i.value[s]=!i.value[s]);var s}},[R("strong",null,"差异 #"+$(e.number),1),R("span",ca,$(i.value[e.number]?"▼":"▶"),1)],8,ua),R("div",da,[R("div",ha,[l[21]||(l[21]=R("span",{class:"label"},"手牌:",-1)),Z(" "+$(e.handStr),1)]),R("div",pa,[l[22]||(l[22]=R("span",{class:"label"},"数组:",-1)),Z(" ["+$(e.hand.join(", "))+"] ",1)]),R("div",ya,[e.pythonResults?(P(),H("div",va,[l[23]||(l[23]=R("span",{class:"lib-name"},"MahjongRepository:",-1)),R("span",ma,$((null==(s=e.pythonResults["mahjong-repository"])?void 0:s.shanten)||"N/A")+"向听",1)])):S("",!0),void 0!==e.niuAlgorithmResult?(P(),H("div",ga,[l[24]||(l[24]=R("span",{class:"lib-name"},"niuAlgorithm:",-1)),R("span",fa,$(e.niuAlgorithmResult)+"向听",1)])):S("",!0)]),i.value[e.number]?(P(),H("div",ba,[l[28]||(l[28]=R("h5",null,"详细分析",-1)),R("div",Ca,[R("div",wa,[l[25]||(l[25]=R("span",{class:"label"},"测试时间:",-1)),R("span",null,$(e.timestamp||(new Date).toLocaleTimeString()),1)]),R("div",ka,[l[26]||(l[26]=R("span",{class:"label"},"差异类型:",-1)),R("span",null,$(G(e)),1)]),R("div",Ta,[l[27]||(l[27]=R("span",{class:"label"},"牌数:",-1)),R("span",null,$(e.hand.length)+"张",1)])]),R("button",{onClick:t=>function(e){return u(this,null,function*(){showError('请使用"库数据分析"功能深入分析此手牌:\n'+e.hand.join(" "))})}(e),class:"btn btn-sm btn-info"}," 深入分析此手牌 ",8,_a)])):S("",!0)])],2)}),128))])])):S("",!0),l[34]||(l[34]=R("div",{class:"info-section"},[R("h3",null,"测试说明"),R("ul",null,[R("li",null,"测试将分批进行，每批处理指定数量的手牌"),R("li",null,"可以随时暂停、继续或停止测试"),R("li",null,"发现差异时会记录详细信息供分析"),R("li",null,"建议先进行小批量测试（如1000手）来评估性能")])],-1)),g.value?(P(),H("div",{key:3,class:"modal-overlay",onClick:te},[R("div",{class:"modal-content",onClick:l[5]||(l[5]=z(()=>{},["stop"]))},[l[32]||(l[32]=R("h3",null,"错误详情",-1)),R("div",xa,[R("p",null,[l[29]||(l[29]=R("strong",null,"时间:",-1)),Z(" "+$(f.value.time),1)]),R("p",null,[l[30]||(l[30]=R("strong",null,"错误信息:",-1)),Z(" "+$(f.value.message),1)]),R("p",null,[l[31]||(l[31]=R("strong",null,"手牌:",-1)),Z(" "+$(null==(r=f.value.hand)?void 0:r.join(" ")),1)]),f.value.stack?(P(),H("pre",Aa,$(f.value.stack),1)):S("",!0)]),R("button",{onClick:te,class:"btn btn-secondary"},"关闭")])])):S("",!0)])}}},[["__scopeId","data-v-6275ccd0"]]);const Pa=new class{constructor(){this.baseURL="http://localhost:8000",this.timeout=3e4,this.stats={totalRequests:0,successfulRequests:0,failedRequests:0,totalResponseTime:0,averageResponseTime:0}}request(e){return u(this,arguments,function*(e,t={}){const s=Date.now(),a=new AbortController,n=setTimeout(()=>a.abort(),this.timeout);try{this.stats.totalRequests++;const l=yield fetch(`${this.baseURL}${e}`,o(i({},t),{signal:a.signal,headers:i({"Content-Type":"application/json",Accept:"application/json"},t.headers)}));if(clearTimeout(n),!l.ok)throw new Error(`HTTP error! status: ${l.status}`);const r=yield l.json(),u=Date.now()-s;return this.stats.successfulRequests++,this.stats.totalResponseTime+=u,this.stats.averageResponseTime=this.stats.totalResponseTime/this.stats.successfulRequests,{success:!0,data:r,responseTime:u,timestamp:(new Date).toISOString()}}catch(l){return clearTimeout(n),this.stats.failedRequests++,{success:!1,error:l.message,responseTime:Date.now()-s,timestamp:(new Date).toISOString()}}})}analyzeHand(e){return u(this,null,function*(){const t={hand:e,config:{}};return yield this.request("/go-analyze",{method:"POST",body:JSON.stringify(t)})})}checkHealth(){return u(this,null,function*(){try{return(yield this.request("/health",{method:"GET"})).success}catch(e){return!1}})}getStats(){return o(i({},this.stats),{successRate:this.stats.totalRequests>0?(this.stats.successfulRequests/this.stats.totalRequests*100).toFixed(2)+"%":"0%"})}resetStats(){this.stats={totalRequests:0,successfulRequests:0,failedRequests:0,totalResponseTime:0,averageResponseTime:0}}},Ra={class:"go-command-analysis"},Sa={class:"analysis-header"},$a={class:"analysis-controls"},ja=["disabled"],Oa={key:0,class:"input-info"},za={class:"info-item"},Ia={class:"value"},Ma={class:"info-item"},Ea={class:"value go-format"},La={class:"info-item"},Ga={class:"value"},Na={class:"info-item"},Da={key:1,class:"error-message"},Za={key:0,class:"error-details"},qa={key:2,class:"analysis-result"},Fa={key:0,class:"result-section"},Ba={class:"parsed-result"},Ua={key:0,class:"result-item"},Wa={class:"result-value shanten"},Va={key:1,class:"analysis-lines"},Ja={class:"analysis-list"},Ka={key:2,class:"improvements"},Ya={class:"improvement-list"},Qa={class:"result-section"},Xa={class:"raw-output"},en={key:0,class:"raw-content"},tn={class:"result-section"},sn={class:"stats-grid"},an={class:"stat-item"},nn={class:"stat-item"},ln={class:"stat-value"},rn={class:"stat-item"},on={class:"stat-value"},un={class:"stat-item"},cn={class:"stat-value"},dn={key:3,class:"usage-info"},hn=pt({__name:"GoCommandAnalysis",setup(e){const{currentHand:t}=Qe(),s=d(!1),a=d(null),n=d(null),l=d(!1),r=()=>u(this,null,function*(){if(t.value&&0!==t.value.length){s.value=!0,n.value=null,a.value=null;try{const e=yield Pa.analyzeHand(t.value);e.success?(a.value=e.data,"error"===e.data.status&&(n.value=e.data.error)):n.value=e.error||"分析失败"}catch(e){n.value=e.message||"分析异常"}finally{s.value=!1}}else n.value="请先选择手牌"}),i=()=>{a.value=null,n.value=null,l.value=!1},o=()=>{l.value=!l.value},c=e=>({success:"成功",error:"错误",timeout:"超时",pending:"处理中"}[e]||"未知");return w(t,e=>{a.value=null,n.value=null,l.value=!1},{deep:!0}),(e,s)=>(P(),H("div",Ra,[R("div",Sa,[s[0]||(s[0]=R("h3",null,"🎯 Go命令行分析",-1)),R("div",$a,[R("button",{onClick:r,class:"analyze-btn"}," 深度分析 "),R("button",{onClick:i,disabled:!a.value,class:"clear-btn"}," 清除结果 ",8,ja)])]),a.value?(P(),H("div",Oa,[R("div",za,[s[1]||(s[1]=R("span",{class:"label"},"输入手牌:",-1)),R("span",Ia,$(j(t).length)+"张",1)]),R("div",Ma,[s[2]||(s[2]=R("span",{class:"label"},"Go格式:",-1)),R("span",Ea,$(a.value.go_tiles),1)]),R("div",La,[s[3]||(s[3]=R("span",{class:"label"},"执行时间:",-1)),R("span",Ga,$((1e3*a.value.execution_time).toFixed(0))+"ms",1)]),R("div",Na,[s[4]||(s[4]=R("span",{class:"label"},"状态:",-1)),R("span",{class:O(["value","status",a.value.status])},$(c(a.value.status)),3)])])):S("",!0),n.value||a.value&&"error"===a.value.status?(P(),H("div",Da,[R("p",null,"❌ 分析失败: "+$(n.value||a.value.error),1),a.value&&"error"===a.value.status?(P(),H("div",Za,s[5]||(s[5]=[R("p",{class:"error-hint"},"可能的原因：",-1),R("ul",null,[R("li",null,"Go工具文件不存在或权限不足"),R("li",null,"手牌格式不正确"),R("li",null,"Python后端连接失败")],-1)]))):S("",!0)])):S("",!0),a.value&&"success"===a.value.status?(P(),H("div",qa,[a.value.parsed_result?(P(),H("div",Fa,[s[9]||(s[9]=R("h4",null,"📊 分析结果",-1)),R("div",Ba,[null!==a.value.parsed_result.shanten?(P(),H("div",Ua,[s[6]||(s[6]=R("span",{class:"result-label"},"向听数:",-1)),R("span",Wa,$(a.value.parsed_result.shanten),1)])):S("",!0),a.value.parsed_result.analysis&&a.value.parsed_result.analysis.length>0?(P(),H("div",Va,[s[7]||(s[7]=R("h5",null,"分析详情:",-1)),R("div",Ja,[(P(!0),H(I,null,M(a.value.parsed_result.analysis,(e,t)=>(P(),H("div",{key:t,class:"analysis-line"},$(e),1))),128))])])):S("",!0),a.value.parsed_result.improvements&&a.value.parsed_result.improvements.length>0?(P(),H("div",Ka,[s[8]||(s[8]=R("h5",null,"改良建议:",-1)),R("div",Ya,[(P(!0),H(I,null,M(a.value.parsed_result.improvements,(e,t)=>(P(),H("div",{key:t,class:"improvement-item"},$(e),1))),128))])])):S("",!0)])])):S("",!0),R("div",Qa,[s[10]||(s[10]=R("h4",null,"📝 原始输出",-1)),R("div",Xa,[R("button",{onClick:o,class:"toggle-btn"},$(l.value?"隐藏":"显示")+" 原始输出 ",1),l.value?(P(),H("pre",en,$(a.value.raw_output),1)):S("",!0)])]),R("div",tn,[s[15]||(s[15]=R("h4",null,"📈 执行统计",-1)),R("div",sn,[R("div",an,[s[11]||(s[11]=R("span",{class:"stat-label"},"执行状态:",-1)),R("span",{class:O(["stat-value",a.value.status])},$(c(a.value.status)),3)]),R("div",nn,[s[12]||(s[12]=R("span",{class:"stat-label"},"处理时间:",-1)),R("span",ln,$((1e3*a.value.execution_time).toFixed(0))+"ms",1)]),R("div",rn,[s[13]||(s[13]=R("span",{class:"stat-label"},"分析时间:",-1)),R("span",on,$(a.value.timestamp),1)]),R("div",un,[s[14]||(s[14]=R("span",{class:"stat-label"},"输出行数:",-1)),R("span",cn,$(a.value.raw_output.split("\n").length),1)])])])])):S("",!0),a.value?S("",!0):(P(),H("div",dn,s[16]||(s[16]=[R("h4",null,"💡 使用说明",-1),R("p",null,"这个功能直接调用Go麻将工具的命令行接口，提供专业的手牌分析。",-1),R("ul",null,[R("li",null,"支持标准14张手牌分析"),R("li",null,"提供向听数计算"),R("li",null,"给出详细的分析建议"),R("li",null,"显示原始Go工具输出")],-1),R("p",{class:"note"}," 注意：需要确保Python后端正在运行，且Go工具文件存在。 ",-1)])))]))}},[["__scopeId","data-v-007eb7ba"]]),pn={class:"loji-analysis"},yn={class:"hand-selection"},vn={class:"tile-pool"},mn={class:"tile-category"},gn={class:"tile-row"},fn=["onClick"],bn=["src","alt"],Cn={class:"tile-count"},wn={class:"tile-category"},kn={class:"tile-row"},Tn=["onClick"],_n=["src","alt"],xn={class:"tile-count"},An={class:"tile-category"},Hn={class:"tile-row"},Pn=["onClick"],Rn=["src","alt"],Sn={class:"tile-count"},$n={class:"tile-category"},jn={class:"tile-row"},On=["onClick"],zn=["src","alt"],In={class:"tile-count"},Mn={class:"analysis-controls"},En=["disabled"],Ln={key:0,class:"analysis-result"},Gn={class:"result-header"},Nn={key:0,class:"listening-info"},Dn={class:"listening-tiles"},Zn=["src","alt"],qn={class:"tile-name"},Fn={key:0,class:"ting-summary"},Bn={class:"ting-stat"},Un={class:"stat-value"},Wn={class:"ting-stat"},Vn={class:"stat-value"},Jn={key:1,class:"recommendations"},Kn={class:"recommendation-list"},Yn={key:0,class:"round-header"},Qn={class:"round-label"},Xn={class:"recommendation-item"},el={class:"discard-tile"},tl=["src","alt"],sl={class:"recommendation-info"},al={class:"progress-text"},nl={class:"waiting-tiles"},ll=["src","alt"],rl={key:0,class:"cache-indicator"},il={key:2,class:"win-info"},ol={class:"win-details"},ul={key:0,class:"hu-info"},cl={class:"hu-label"},dl={class:"hu-value"},hl=pt({__name:"LojiAnalysis",setup(e){const{currentHand:t,isAnalyzing:s,analysisResult:a,analyzeHand:n,canAnalyze:l,addTile:r}=Qe(),o=_(()=>{var e;return(null==(e=a.value)?void 0:e.recommendations)?a.value.recommendations.map(e=>i({id:e.id||Date.now()+Math.random(),discardTile:e.discardTile||e.key,waitingTiles:e.waitingTiles||e.value||[],waitingCount:e.waitingCount||e.tingCount||0,round:e.round||0,priority:e.priority||1,description:e.description||"",cached:e.cached||!1},e)):[]});_(()=>function(e){if(!e)return"未分析";const t=Je(e.status||e.hu_type),s=e.ting_tiles||e.tingCards||[],a=e.recommendations||[];let n=t;return s.length>0&&(n+=`，听${s.length}张牌`),a.length>0&&(n+=`，${a.length}个推荐`),n}(a.value));const c=_(()=>{if(!a.value)return!1;if(!(1===a.value.hu_type||"ready"===a.value.status))return!1;const e=t.value.length;if(Ne.includes(e))return!1;return(a.value.ting_tiles||[]).length>0}),d=e=>t.value.filter(t=>t===e).length,h=e=>{if(t.value.length>=Le)return void We("手牌已满");t.value.filter(t=>t===e).length>=Ge?We("此牌已达到最大数量"):r(e)},p=(e,t)=>{if(0===t)return!0;const s=o.value[t-1];return e.round!==(null==s?void 0:s.round)},y=e=>e.description?e.description:function(e){if(!e)return"";const{waitingCount:t=0,waitingTiles:s=[],round:a=0,description:n}=e;if(n)return n;const l=s.length;return a>=2?`可进${a}听，听${l}门${t}张`:`可听${l}门${t}张`}(e),v=e=>e.waitingTiles||e.value||[],m=()=>u(this,null,function*(){if(!(t.value&&t.value.length>0))return void We("请先选择手牌");const e=t.value.length;if(e>14)We("手牌不能超过14张");else if(0!==e)try{const e=yield n();e&&e.success?Ue("分析完成"):We((null==e?void 0:e.message)||"分析失败")}catch(s){We("分析过程中发生错误，请重试")}else We("请选择至少一张牌")}),g=e=>Je(e);return(e,t)=>{var n,r;return P(),H("div",pn,[t[11]||(t[11]=R("div",{class:"analysis-header"},null,-1)),R("div",yn,[R("div",vn,[R("div",mn,[t[0]||(t[0]=R("h5",null,"万字牌",-1)),R("div",gn,[(P(),H(I,null,M(9,e=>R("div",{key:`man-${e}`,class:O(["tile-option",{disabled:d(e)>=4}]),onClick:t=>h(e)},[R("img",{src:j(Fe)(e),alt:`${e}万`},null,8,bn),R("span",Cn,$(4-d(e)),1)],10,fn)),64))])]),R("div",wn,[t[1]||(t[1]=R("h5",null,"筒子牌",-1)),R("div",kn,[(P(),H(I,null,M(9,e=>R("div",{key:`pin-${e}`,class:O(["tile-option",{disabled:d(e+10)>=4}]),onClick:t=>h(e+10)},[R("img",{src:j(Fe)(e+10),alt:`${e}筒`},null,8,_n),R("span",xn,$(4-d(e+10)),1)],10,Tn)),64))])]),R("div",An,[t[2]||(t[2]=R("h5",null,"条子牌",-1)),R("div",Hn,[(P(),H(I,null,M(9,e=>R("div",{key:`sou-${e}`,class:O(["tile-option",{disabled:d(e+20)>=4}]),onClick:t=>h(e+20)},[R("img",{src:j(Fe)(e+20),alt:`${e}条`},null,8,Rn),R("span",Sn,$(4-d(e+20)),1)],10,Pn)),64))])]),R("div",$n,[t[3]||(t[3]=R("h5",null,"字牌",-1)),R("div",jn,[(P(),H(I,null,M(["东","南","西","北","中","发","白"],(e,t)=>R("div",{key:`honor-${t}`,class:O(["tile-option",{disabled:d(31+t)>=4}]),onClick:e=>h(31+t)},[R("img",{src:j(Fe)(31+t),alt:e},null,8,zn),R("span",In,$(4-d(31+t)),1)],10,On)),64))])])])]),R("div",Mn,[R("button",{onClick:m,disabled:!j(l)||j(s),class:"btn btn-primary"},$(j(s)?"🔍 分析中...":"🔍 分析听牌"),9,En)]),j(a)?(P(),H("div",Ln,[R("div",Gn,[R("h4",null,"分析结果 "+$(c.value?j(Ke)(j(a)):""),1),R("div",{class:O(["result-status",(r=j(a).hu_type,Ve(r))])},$(g(j(a).hu_type)),3)]),c.value?(P(),H("div",Nn,[R("h5",null,"🎯 听牌 "+$(j(Ke)(j(a))),1),R("div",Dn,[(P(!0),H(I,null,M(j(a).ting_tiles||[],e=>(P(),H("div",{key:e,class:"listening-tile"},[R("img",{src:j(Fe)(e),alt:j(Be)(e)},null,8,Zn),R("span",qn,$(j(Be)(e)),1)]))),128))]),j(a).metadata||j(a).ting_count?(P(),H("div",Fn,[R("div",Bn,[t[4]||(t[4]=R("span",{class:"stat-label"},"进听数：",-1)),R("span",Un,$((null==(n=j(a).metadata)?void 0:n.round)||1)+"进听",1)]),R("div",Wn,[t[5]||(t[5]=R("span",{class:"stat-label"},"听牌数：",-1)),R("span",Vn,$((j(a).ting_tiles||[]).length)+"门"+$(j(a).ting_count||0)+"张",1)])])):S("",!0)])):S("",!0),j(a).recommendations&&j(a).recommendations.length>0?(P(),H("div",Jn,[t[8]||(t[8]=R("h5",null,"🎯 推荐打牌",-1)),R("div",Kn,[(P(!0),H(I,null,M(o.value,(e,s)=>(P(),H("div",{key:e.id||s,class:"recommendation-group"},[p(e,s)?(P(),H("div",Yn,[R("span",Qn,$(e.round||1)+"进听",1),t[6]||(t[6]=R("div",{class:"round-divider"},null,-1))])):S("",!0),R("div",Xn,[R("div",el,[t[7]||(t[7]=R("span",{class:"action-label"},"打",-1)),R("img",{src:j(Fe)(e.discardTile||e.key),alt:j(Be)(e.discardTile||e.key)},null,8,tl)]),R("div",sl,[R("span",al,$(y(e)),1),R("div",nl,[(P(!0),H(I,null,M(v(e),e=>(P(),H("img",{key:e,src:j(Fe)(e),alt:j(Be)(e),class:"wait-tile"},null,8,ll))),128))]),e.cached?(P(),H("div",rl," ⚡ 缓存结果 ")):S("",!0)])])]))),128))])])):S("",!0),2===j(a).hu_type?(P(),H("div",il,[t[10]||(t[10]=R("h5",null,"🎉 胡牌",-1)),R("div",ol,[t[9]||(t[9]=R("p",null,"恭喜！当前手牌已经胡牌",-1)),j(a).hu_info?(P(),H("div",ul,[(P(!0),H(I,null,M(j(a).hu_info,(e,t)=>(P(),H("div",{key:t,class:"hu-detail"},[R("span",cl,$(t)+":",1),R("span",dl,$(e),1)]))),128))])):S("",!0)])])):S("",!0)])):S("",!0)])}}},[["__scopeId","data-v-6e7a2297"]]),pl={TOAST_ICONS:{success:"✅",warning:"⚠️",error:"❌",info:"ℹ️"}},yl=e=>pl.TOAST_ICONS[e]||pl.TOAST_ICONS.info,vl={class:"toast-content"},ml={class:"toast-icon"},gl={class:"toast-text"},fl={class:"toast-message"},bl={key:0,class:"toast-subtitle"},Cl={key:0,class:"toast-progress"},wl=pt({__name:"Toast",props:{show:{type:Boolean,default:!1},message:{type:String,default:""},subtitle:{type:String,default:""},type:{type:String,default:"info",validator:e=>["success","warning","error","info"].includes(e)},persistent:{type:Boolean,default:!1},closable:{type:Boolean,default:!0},duration:{type:Number,default:3e3}},emits:["close"],setup:e=>(t,s)=>(P(),U(V,{name:"toast",appear:""},{default:W(()=>[e.show?(P(),H("div",{key:0,class:O(["toast",`toast-${e.type}`,{"toast-persistent":e.persistent}])},[R("div",vl,[R("span",ml,$(j(yl)(e.type)),1),R("div",gl,[R("span",fl,$(e.message),1),e.subtitle?(P(),H("span",bl,$(e.subtitle),1)):S("",!0)]),!e.persistent||e.closable?(P(),H("button",{key:0,onClick:s[0]||(s[0]=e=>t.$emit("close")),class:"toast-close"},"×")):S("",!0)]),!e.persistent&&e.duration>0?(P(),H("div",Cl,[R("div",{class:"toast-progress-bar",style:B({animationDuration:`${e.duration}ms`})},null,4)])):S("",!0)],2)):S("",!0)]),_:1}))},[["__scopeId","data-v-791041b6"]]),kl={class:"simple-mahjong-app"},Tl={class:"analysis-content"},_l=pt({__name:"App",setup(e){ht();const{showAlgorithmTest:t,showGoCommandAnalysis:s,showLojiAnalysis:a,showHandHistory:n}=et();return(e,l)=>(P(),H("div",kl,[G(Et),G(Nt,null,{default:W(()=>[j(t)?(P(),U(Ha,{key:0})):S("",!0),j(s)?(P(),U(hn,{key:1})):S("",!0),j(a)?(P(),U(hl,{key:2})):S("",!0),R("div",Tl,[j(n)?(P(),U(us,{key:0})):S("",!0)])]),_:1}),G(wl),G(Ut)]))}},[["__scopeId","data-v-2e973eec"]]),xl=function(){const e=c(!0),t=e.run(()=>d({}));let s=[],a=[];const n=h({install(e){Y(n),n._a=e,e.provide(Q,n),e.config.globalProperties.$pinia=n,a.forEach(e=>s.push(e)),a=[]},use(e){return this._a?s.push(e):a.push(e),this},_p:s,_a:null,_e:e,_s:new Map,state:t});return n}(),Al=J(_l);Al.use(xl),Al.mount("#app");
